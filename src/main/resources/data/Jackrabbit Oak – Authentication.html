<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/security/authentication.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Authentication</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../"  title="Oak logo"><img src="../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../license.html" title="License">License</a></li>
            <li><a href="../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../security/reports.html" title="Reports">Reports</a></li>
                  <li><a title="Authentication">Authentication</a></li>
                  <li><a href="../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../migration.html" title="Migration">Migration</a></li>
            <li><a href="../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../participating.html" title="Participating">Participating</a></li>
            <li><a href="../testing.html" title="Testing">Testing</a></li>
            <li><a href="../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Authentication <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/security/authentication.md"><img src="../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li class="active"><a><span class="icon-chevron-down"></span>Authentication</a>
       <ul class="nav nav-list">
        <li><a href="../security/authentication/differences.html" title="Differences"><span class="none"></span>Differences</a></li>
        <li><a href="../security/authentication/default.html" title="Default"><span class="none"></span>Default</a></li>
        <li><a href="../security/authentication/preauthentication.html" title="Pre-Authentication"><span class="none"></span>Pre-Authentication</a></li>
        <li><a href="javascript:void(0)" title="Extensions"><span class="icon-chevron-down"></span>Extensions</a>
         <ul class="nav nav-list">
          <li><a href="../security/authentication/tokenmanagement.html" title="Token"><span class="none"></span>Token</a></li>
          <li><a href="../security/authentication/externalloginmodule.html" title="External"><span class="icon-chevron-right"></span>External</a></li>
         </ul></li>
       </ul></li>
      <li><a href="../security/authorization.html" title="Authorization"><span class="icon-chevron-right"></span>Authorization</a></li>
      <li><a href="../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<section>
<h2><a name="Authentication"></a>Authentication</h2><section>
<h3><a name="JAAS_Authentication_and_Login_Modules"></a>JAAS Authentication and Login Modules</h3><section>
<h4><a name="General_Concepts"></a>General Concepts</h4>
<p>In order to understand how login modules work and how Oak can help providing extension points we need to look at how
JAAS authentication works in general and discuss where the actual credential-verification is performed.</p><section>
<h5><a name="Brief_recap_of_the_JAAS_authentication"></a>Brief recap of the JAAS authentication</h5>
<p>The following section is copied and adapted from the javadoc of <a class="externalLink" href="http://docs.oracle.com/javase/6/docs/api/javax/security/auth/spi/LoginModule.html">javax.security.auth.spi.LoginModule</a>.
The authentication process within the <code>LoginModule</code> proceeds in two distinct phases,
login and commit phase:</p>
<p><i>Phase 1: Login</i></p>
<ol style="list-style-type: decimal">

<li>In the first phase, the <code>LoginModule</code>'s <code>login</code> method gets invoked by the <code>LoginContext</code>'s <code>login</code> method.</li>
<li>The <code>login</code> method for the <code>LoginModule</code> then performs the actual authentication (prompt for and verify a
password for example) and saves its authentication status as private state information.</li>
<li>Once finished, the <code>LoginModule</code>'s login method either returns <code>true</code> (if it succeeded) or <code>false</code> (if it should
be ignored), or throws a <code>LoginException</code> to specify a failure. In the failure case, the <code>LoginModule</code> must not
retry the authentication or introduce delays. The responsibility of such tasks belongs to the application.
If the application attempts to retry the authentication, the <code>LoginModule</code>'s <code>login</code> method will be called again.</li>
</ol>
<p><i>Phase 2: Commit</i></p>
<ol style="list-style-type: decimal">

<li>In the second phase, if the <code>LoginContext</code>'s overall authentication succeeded (the relevant REQUIRED, REQUISITE,
SUFFICIENT and OPTIONAL LoginModules succeeded), then the <code>commit</code> method for the <code>LoginModule</code> gets invoked.</li>
<li>The <code>commit</code> method for a <code>LoginModule</code> checks its privately saved state to see if its own authentication
succeeded.</li>
<li>If the overall <code>LoginContext</code> authentication succeeded and the <code>LoginModule</code>'s own authentication succeeded, then
the <code>commit</code> method associates the relevant Principals (authenticated identities) and Credentials (authentication
data such as cryptographic keys) with the Subject located within the <code>LoginModule</code>.</li>
<li>If the <code>LoginContext</code>'s overall authentication failed (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
LoginModules did not succeed), then the <code>abort</code> method for each <code>LoginModule</code> gets invoked. In this case, the
<code>LoginModule</code> removes/destroys any authentication state originally saved.</li>
</ol></section><section>
<h5><a name="Login_module_execution_order"></a>Login module execution order</h5>
<p>Very simply put, all the login modules that participate in JAAS authentication are configured in a list and can have
flags indicating how to treat their behaviors on the <code>login()</code> calls.</p>
<p>JAAS defines the following module flags:<br />
(The following section is copied and adapted from the javadoc of <a class="externalLink" href="http://docs.oracle.com/javase/6/docs/api/javax/security/auth/login/Configuration.html">javax.security.auth.login.Configuration</a>)</p>
<ul>

<li><b>Required</b>:  The LoginModule is required to succeed. If it succeeds or fails,
authentication still continues to proceed down the LoginModule list.</li>
<li><b>Requisite</b>: The LoginModule is required to succeed. If it succeeds, authentication
continues down the LoginModule list. If it fails, control immediately returns
to the application (authentication does not proceed down the LoginModule list).</li>
<li><b>Sufficient</b>: The LoginModule is not required to succeed. If it does succeed,
control immediately returns to the application (authentication does not proceed
down the LoginModule list). If it fails, authentication continues down the LoginModule list.</li>
<li><b>Optional</b>: The LoginModule is not required to succeed. If it succeeds or
fails, authentication still continues to proceed down the LoginModule list.</li>
</ul>
<p>The overall authentication succeeds <b>only</b> if <b>all</b> Required and Requisite LoginModules succeed. If a Sufficient
LoginModule is configured and succeeds, then only the Required and Requisite LoginModules prior to that Sufficient
LoginModule need to have succeeded for the overall authentication to succeed. If no Required or Requisite LoginModules
are configured for an application, then at least one Sufficient or Optional LoginModule must succeed.</p>
<p><a name="jcr_api"></a></p></section></section></section><section>
<h3><a name="JCR_API"></a>JCR API</h3>
<p>Within the scope of JCR <code>Repository.login</code> is used to authenticate a given user.
This method either takes a <code>Credentials</code> argument if the validation is performed
by the repository itself or <code>null</code> in case the user has be pre-authenticated by
an external system.</p>
<p>Furthermore JCR defines two types of <code>Credentials</code> implementations:</p>
<ul>

<li><a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/GuestCredentials.html">javax.jcr.GuestCredentials</a>: used to obtain a &#x201c;guest&#x201d;, &#x201c;public&#x201d; or &#x201c;anonymous&#x201d; session.</li>
<li><a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/SimpleCredentials.html">javax.jcr.SimpleCredentials</a>: used to login a user with a userId and password.</li>
</ul>
<p>The following variants exist for the repository login itself:</p>
<ul>

<li><code>Repository.login()</code>: equivalent to passing <code>null</code> credentials and the default workspace name.</li>
<li><code>Repository.login(Credentials credentials)</code>: login with credentials to the default workspace.</li>
<li><code>Repository.login(String workspace)</code>: login with <code>null</code> credentials to the workspace with the specified name.</li>
<li><code>Repository.login(Credentials credentials, String workspaceName)</code></li>
<li><code>JackrabbitRepository.login(Credentials credentials, String workspaceName, Map&lt;String, Object&gt; attributes)</code>:
in addition allows to pass implementation specific session attributes.</li>
</ul>
<p>See <a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/Repository.html">javax.jcr.Repository</a> and <a href="/oak/docs/apidocs/org/apache/jackrabbit/api/JackrabbitRepository.html">org.apache.jackrabbit.api.JackrabbitRepository</a>
for further details.</p>
<p>In addition JCR defines <code>Session.impersonate(Credentials)</code> to impersonate another
user or - as of JSR 333 -  clone an existing session.</p>
<p><a name="oak_api"></a></p></section><section>
<h3><a name="Oak_API"></a>Oak API</h3>
<p>The Oak API contains the following authentication related methods and interfaces</p>
<ul>

<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/api/AuthInfo.html">AuthInfo</a>: Immutable object created upon successful login providing information about the authenticated <code>Subject.</code></li>
<li><code>ContentRepository.login(Credentials, String)</code>: The Oak counterpart of the JCR login.</li>
<li><code>ContentSession.getAuthInfo()</code>: exposes the <code>AuthInfo</code> associated with the <code>ContentSession</code>.</li>
</ul>
<p><a name="api_extensions"></a></p></section><section>
<h3><a name="API_Extension"></a>API Extension</h3><section>
<h4><a name="Oak_Authentication"></a>Oak Authentication</h4>
<p>In the the package <code>org.apache.jackrabbit.oak.spi.security.authentication</code> Oak 1.0
defines some extensions points that allow for further customization of the authentication.</p>
<ul>

<li><code>LoginContextProvider</code>: Configurable provider of the <code>LoginContext</code> (see below)</li>
<li><code>LoginContext</code>: Interface version of the JAAS LoginContext aimed to ease integration with non-JAAS components</li>
<li><code>Authentication</code>: Aimed to validate credentials during the first phase of the (JAAS) login process.</li>
</ul>
<p>In addition this package contains various utilities and base implementations.
Most notably an abstract login module implementation (<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/AbstractLoginModule.html">AbstractLoginModule</a>) as
described below and a default implementation of the AuthInfo interface (<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/AuthInfoImpl.html">AuthInfoImpl</a>).</p><section>
<h5><a name="Abstract_Login_Module"></a>Abstract Login Module</h5>
<p>This package also contains a abstract <code>LoginModule</code> implementation (<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/AbstractLoginModule.html">AbstractLoginModule</a>)
providing common functionality. In particular it contains Oak specific methods that allow
subclasses to retrieve the <code>SecurityProvider</code>, a <code>Root</code> and accesss to various
security related interfaces (e.g. <code>PrincipalManager</code>).</p>
<p>Subclasses are required to implement the following methods:</p>
<ul>

<li><code>getSupportedCredentials()</code>: return a set of supported credential classes. See also section <a href="#supported_credentials">Supported Credentials</a></li>
<li><code>login()</code>: The login method defined by <code>LoginModule</code></li>
<li><code>commit()</code>: The commit method defined by <code>LoginModule</code></li>
</ul><section>
<h6><a name="Example:_Extending_AbstractLoginModule"></a>Example: Extending AbstractLoginModule</h6>

<div class="source"><pre class="prettyprint"><code>public class TestLoginModule extends AbstractLoginModule {

    private Credentials credentials;
    private String userId;
    private Set&lt;? extends Principal&gt; principals;

    @Nonnull
    @Override
    protected Set&lt;Class&gt; getSupportedCredentials() {
        return ImmutableSet.of(TestCredentials.class);
    }

    @Override
    public boolean login() throws LoginException {
        credentials = getCredentials();
        if (validCredentials(credentials)) {
            this.credentials = credentials;
            this.userId = getUserId(credentials);
            this.principals = getPrincipals(userId);
            return true;
        }
        return false;
    }

    @Override
    public boolean commit() throws LoginException {
        if (credentials != null) {
            if (!subject.isReadOnly()) {
                subject.getPublicCredentials().add(credentials);
                if (principals != null) {
                    subject.getPrincipals().addAll(principals);
                }
                AuthInfo authInfo = new AuthInfoImpl(userId, Collections.EMPTY_MAP, principals);
                setAuthInfo(authInfo, subject);
            }
            return true;
        }
        return false;
    }
}
</code></pre></div>
<p><a name="supported_credentials"></a></p></section></section></section><section>
<h4><a name="Supported_Credentials"></a>Supported Credentials</h4>
<p>Since Oak 1.5.1 the extensions additionally contain a dedicated interface that
eases the support for different <code>Credentials</code> in the package space
<code>org.apache.jackrabbit.oak.spi.security.authentication.credentials</code>:</p>
<ul>

<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/credentials/CredentialsSupport.html">CredentialsSupport</a>: Interface definition exposing the set of supported <code>Credentials</code> classes and some common utility methods.</li>
<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/credentials/SimpleCredentialsSupport.html">SimpleCredentialsSupport</a>: Default implementation for the widely used <code>SimpleCredentials</code></li>
</ul>
<p><a name="default_implementation"></a></p></section></section><section>
<h3><a name="Oak_Authentication_Implementation"></a>Oak Authentication Implementation</h3>
<p>A description of the various requirements covered by Oak by default as well
as the characteristics of the corresponding implementations can be found in
section <a href="authentication/default.html">Authentication: Implementation Details</a>.</p>
<p>See section <a href="authentication/differences.html">differences</a> for comprehensive list
of differences wrt authentication between Jackrabbit 2.x and Oak.</p>
<p><a name="configuration"></a></p></section><section>
<h3><a name="Configuration"></a>Configuration</h3>
<p>The configuration of the authentication setup is defined by the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/AuthenticationConfiguration.html">AuthenticationConfiguration</a>.
This interface provides the following method:</p>
<ul>

<li><code>getLoginContextProvider()</code>: provides the login contexts for the desired authentication mechanism.</li>
</ul><section>
<h4><a name="JAAS_Configuration_Utilities"></a>JAAS Configuration Utilities</h4>
<p>There also exists a utility class that allows to obtain different
<code>javax.security.auth.login.Configuration</code> for the most common setup [11]:</p>
<ul>

<li><code>ConfigurationUtil#getDefaultConfiguration</code>: default OAK configuration supporting uid/pw login configures <code>LoginModuleImpl</code> only</li>
<li><code>ConfigurationUtil#getJackrabbit2Configuration</code>: backwards compatible configuration that provides the functionality covered by jackrabbit-core DefaultLoginModule, namely:
<ul>

<li><code>GuestLoginModule</code>: null login falls back to anonymous</li>
<li><code>TokenLoginModule</code>: covers token based authentication</li>
<li><code>LoginModuleImpl</code>: covering regular uid/pw login</li>
</ul>
</li>
</ul>
<p><a name="pluggability"></a></p></section></section><section>
<h3><a name="Pluggability"></a>Pluggability</h3>
<p>The default security setup as present with Oak 1.0 is able to provide custom
implementation on various levels:</p>
<ol style="list-style-type: decimal">

<li>The complete authentication setup can be changed by plugging a different
<code>AuthenticationConfiguration</code> implementations. In OSGi-base setup this is
achieved by making the configuration a service. In a non-OSGi-base setup the
custom configuration must be exposed by the <code>SecurityProvider</code> implementation.</li>
<li>Within the default authentication setup you replace or extend the set of
login modules and their individual settings. In an OSGi-base setup is achieved
by making the modules accessible to the framework and setting their execution
order accordingly. In a non-OSGi setup this is specified in the <a class="externalLink" href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html">JAAS config</a>.</li>
</ol><section><section>
<h5><a name="Examples"></a>Examples</h5><section>
<h6><a name="Custom_LoginModule_in_non-OSGi_setup"></a>Custom LoginModule in non-OSGi setup</h6>

<div class="source"><pre class="prettyprint"><code>import javax.security.auth.login.AppConfigurationEntry
import javax.security.auth.login.Configuration;

AppConfigurationEntry[] entries = new AppConfigurationEntry[]{new DefaultEntry(options)};
Configuration c = new Configuration() {
     @Override
     public AppConfigurationEntry[] getAppConfigurationEntry(String applicationName) {
         Map&lt;String, ?&gt; options = [....];
         
         // choose control flag for custom login module (example here: REQUIRED)
         AppConfigurationEntry.LoginModuleControlFlag flag = LoginModuleControlFlag.SUFFICIENT;
         
         // create an entry for your custom login module
         AppConfigurationEntry customEntry = new AppConfigurationEntry(&quot;your.org.LoginModuleClassName&quot;, flag, options)
         
         // additionally use the oak default login module
         AppConfigurationEntry defaultEntry = new AppConfigurationEntry((&quot;org.apache.jackrabbit.oak.security.authentication.user.LoginModuleImpl&quot;, LoginModuleControlFlag.REQUIRED, options)
         
         // define array of all entries in the correct order according to your needs
         return new AppConfigurationEntry[]{customEntry, defaultEntry};
     }
};
Configuration.setConfiguration(c);
</code></pre></div>
<p><a name="further_reading"></a></p></section></section></section></section><section>
<h3><a name="Further_Reading"></a>Further Reading</h3>
<ul>

<li><a href="authentication/default.html">Authentication: Implementation Details</a></li>
<li><a href="authentication/differences.html">Differences wrt Jackrabbit 2.x</a></li>
<li><a href="authentication/tokenmanagement.html">Token Authentication and Token Management</a></li>
<li><a href="authentication/externalloginmodule.html">External Authentication</a>
<ul>

<li><a href="authentication/usersync.html">User and Group Synchronization</a></li>
<li><a href="authentication/identitymanagement.html">Identity Management</a></li>
<li><a href="authentication/ldap.html">LDAP Integration</a></li>
</ul>
</li>
<li><a href="authentication/preauthentication.html">Pre-Authentication</a></li>
</ul><!-- references --></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>