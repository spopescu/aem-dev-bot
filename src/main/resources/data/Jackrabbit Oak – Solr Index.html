<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/query/solr.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Solr Index</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../"  title="Oak logo"><img src="../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../license.html" title="License">License</a></li>
            <li><a href="../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../migration.html" title="Migration">Migration</a></li>
            <li><a href="../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../participating.html" title="Participating">Participating</a></li>
            <li><a href="../testing.html" title="Testing">Testing</a></li>
            <li><a href="../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Solr Index <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/query/solr.md"><img src="../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li class="active"><a><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../security/authentication.html" title="Authentication"><span class="icon-chevron-right"></span>Authentication</a></li>
      <li><a href="../security/authorization.html" title="Authorization"><span class="icon-chevron-right"></span>Authorization</a></li>
      <li><a href="../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  -->
<section>
<h2><a name="Solr_Index"></a>Solr Index</h2>
<p>The Solr index is mainly meant for full-text search (the &#x2018;contains&#x2019; type of queries):</p>

<div class="source"><pre class="prettyprint"><code>//*[jcr:contains(., 'text')]
</code></pre></div>
<p>but is also able to search by path and property restrictions.
Primary type restriction support is also provided by it's not recommended as it's usually much better to use the <a href="query.html#The_Node_Type_Index">node type
index</a> for such kind of queries.</p>
<p>Even if it's not just a full-text index, it's recommended to use it asynchronously (see <code>Oak#withAsyncIndexing</code>)
because, in most production scenarios, it'll be a &#x2018;remote&#x2019; index and therefore network latency / errors would
have less impact on the repository performance.</p>
<p>The index definition node for a Solr-based index:</p>
<ul>

<li>must be of type <code>oak:QueryIndexDefinition</code></li>
<li>must have the <code>type</code> property set to <b><code>solr</code></b></li>
<li>must contain the <code>async</code> property set to the value <code>async</code>, this is what sends the index update process to a background thread.</li>
</ul>
<p><i>Optionally</i> one can add</p>
<ul>

<li>the <code>reindex</code> flag which when set to <code>true</code>, triggers a full content re-index.</li>
</ul>
<p>Example:</p>

<div class="source"><pre class="prettyprint"><code>{
  NodeBuilder index = root.child(&quot;oak:index&quot;);
  index.child(&quot;solr&quot;)
    .setProperty(&quot;jcr:primaryType&quot;, &quot;oak:QueryIndexDefinition&quot;, Type.NAME)
    .setProperty(&quot;type&quot;, &quot;solr&quot;)
    .setProperty(&quot;async&quot;, &quot;async&quot;)
    .setProperty(&quot;reindex&quot;, true);
}
</code></pre></div>
<p>The Oak Solr index creates one document in the Solr index for each node in the repository, each of such documents has
usually at least a field for each property associated with the related node.
Indexing of properties can be done by name: e.g. property &#x2018;jcr:title&#x2019; of a node is written into a field &#x2018;jcr:title&#x2019; of
the corresponding Solr document in the index, or by type: e.g. properties &#x2018;jcr:data&#x2019; and &#x2018;binary_content&#x2019; of type
<i>binary</i> are written into a field &#x2018;binary_data&#x2019; that's responsible for the indexing of all fields having that type and
thus properly configured for hosting such type of data.</p><section>
<h3><a name="Configuring_the_Solr_index"></a>Configuring the Solr index</h3>
<p>Besides the index definition parameters mentioned above, a number of additional parameters can be defined in
Oak Solr index configuration.
Such a configuration is composed by:</p>
<ul>

<li>the search / indexing configuration (see <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/configuration/OakSolrConfiguration.html">OakSolrConfiguration</a>)</li>
<li>the Solr server configuration (see <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/configuration/SolrServerConfiguration.html">SolrServerConfiguration</a>)</li>
</ul></section><section>
<h3><a name="Search_.2F_indexing_configuration_options"></a>Search / indexing configuration options</h3>
<p>Such options define how Oak handles search and indexing requests in order to properly delegate such operations to Solr.</p><section>
<h4><a name="Use_for_property_restrictions"></a>Use for property restrictions</h4>
<p>If set to <i>true</i> the Solr index will be used also for filtering nodes by property restrictions.</p>
<p>Default is &#x2018;false&#x2019;.</p></section><section>
<h4><a name="Use_for_path_restrictions"></a>Use for path restrictions</h4>
<p>If set to <i>true</i> the Solr index will be used also for filtering nodes by path restrictions.</p>
<p>Default is &#x2018;false&#x2019;.</p></section><section>
<h4><a name="Use_for_primary_types"></a>Use for primary types</h4>
<p>If set to <i>true</i> the Solr index will be used also for filtering nodes by primary type.</p>
<p>Default is &#x2018;false&#x2019;.</p></section><section>
<h4><a name="Path_field"></a>Path field</h4>
<p>The name of the field to be used for searching an exact match of a certain path.</p>
<p>Default is &#x2018;path_exact&#x2019;.</p></section><section>
<h4><a name="Catch_all_field"></a>Catch all field</h4>
<p>The name of the field to be used for searching when no specific field is defined in the search query (e.g. user entered
queries like &#x2018;foo bar&#x2019;).</p>
<p>Default is &#x2018;catch_all&#x2019;.</p>
<p>Default Solr schema.xml provided with Oak Solr index contains a copyField from everything to &#x2018;catch_all&#x2019;, that causing
all the properties of a certain node to be indexed into that field (as separate values) therefore a query run against
that field would match if any of the properties of the original node would have matched such a query.</p></section><section>
<h4><a name="Descendant_path_field"></a>Descendant path field</h4>
<p>The name of the field to be used for searching for nodes descendants of a certain node.</p>
<p>Default is &#x2018;path_des&#x2019;.</p>
<p>E.g. The Solr query to find all the descendant nodes of /a/b would be &#x2018;path_des:/a/b&#x2019;.</p></section><section>
<h4><a name="Children_path_field"></a>Children path field</h4>
<p>The name of the field to be used for searching for child nodes of a certain node.</p>
<p>Default is &#x2018;path_child&#x2019;.</p>
<p>E.g. The Solr query to find all the child nodes of /a/b would be &#x2018;path_child:/a/b&#x2019;.</p></section><section>
<h4><a name="Parent_path_field"></a>Parent path field</h4>
<p>The name of the field to be used for searching for parent node of a certain node.</p>
<p>Default is &#x2018;path_anc&#x2019;.</p>
<p>E.g. The Solr query to find the parent node of /a/b would be &#x2018;path_anc:/a/b&#x2019;.</p></section><section>
<h4><a name="Property_restriction_fields"></a>Property restriction fields</h4>
<p>The (optional) mapping of property names into Solr fields, so that a mapping jcr:title=foo is defined each node having
the property jcr:title will have its correspondant Solr document having a property foo indexed with the value of the
jcr:title property.</p>
<p>Default is no mapping, therefore the default mechanism of mapping property names to field names is performed.</p></section><section>
<h4><a name="Used_properties"></a>Used properties</h4>
<p>A whitelist of properties to be used for indexing / searching by Solr index.
Such a whitelist, if not empty, would dominate whatever configuration defined for the <a href="#Ignored_properties">Ignored_properties</a>.</p>
<p>Default is an empty list.</p>
<p>E.g. If such a whitelist contains properties <i>jcr:title</i> and <i>text</i> the Solr index will only index such properties for each
node and will be possible to use it for searching only on those two properties.</p>
<p>####&#xa0;Ignored properties
A blacklist of properties to be ignored while indexing and searching by the Solr index.</p>
<p>Such a blacklist makes sense (it will be taken into account by the Solr index) only if the <a href="#Used_properties">Used properties</a>
option doesn't have any value.</p>
<p>Default is the following array: <i>(&#x201c;rep:members&#x201d;, &#x201c;rep:authorizableId&#x201d;, &#x201c;jcr:uuid&#x201d;, &#x201c;rep:principalName&#x201d;, &#x201c;rep:password&#x201d;}</i>.</p></section><section>
<h4><a name="Commit_policy"></a>Commit policy</h4>
<p>The Solr commit policy to be used when indexing nodes as documents in Solr.</p>
<p>Possible values are &#x2018;SOFT&#x2019;, &#x2018;HARD&#x2019;, &#x2018;AUTO&#x2019;.</p>
<p>SOFT: perform a Solr soft-commit for each indexed document.</p>
<p>HARD: perform a Solr (hard) commit for each indexed document.</p>
<p>AUTO: doesn't perform any commit and relies on auto commit being configured on plain Solr's configuration (solrconfig.xml).</p>
<p>Default is <i>SOFT</i>.</p></section><section>
<h4><a name="Rows"></a>Rows</h4>
<p>The number of documents per &#x2018;page&#x2019; to be fetched for each query.</p>
<p>Default is <i>10</i>.</p></section><section>
<h4><a name="Collapse_jcr:content_nodes"></a>Collapse <i>jcr:content</i> nodes</h4>
<p><code>@since 1.3.4, 1.2.4, 1.0.18</code></p>
<p>Whether the <a class="externalLink" href="https://cwiki.apache.org/confluence/display/solr/Collapse+and+Expand+Results">Collapsing query parser</a> should
be used when searching in order to collapse nodes that are descendants of &#x2018;jcr:content&#x2019; nodes into the &#x2018;jcr:content&#x2019; node only.
E.g. if normal query results would include &#x2018;/a/jcr:content&#x2019; and &#x2018;/a/jcr:content/b/&#x2019;, with this option enabled only
&#x2018;/a/jcr:content&#x2019; would be returned by Solr using the Collapsing query parser.
This feature requires an additional field to be indexed, therefore if this is turned on, reindexing should be triggered
in order to make it work properly.</p></section><section>
<h4><a name="Collapsed_path_field"></a>Collapsed path field</h4>
<p><code>@since 1.3.4, 1.2.4, 1.0.18</code></p>
<p>The name of the field used for collapsing descendants of jcr:content nodes, see &#x2018;Collapse jcr:content nodes&#x2019; option.</p><section>
<h5><a name="Solr_server_configuration_options"></a>Solr server configuration options</h5>
<p>TBD</p></section></section><section>
<h4><a name="Setting_up_the_Solr_server"></a>Setting up the Solr server</h4>
<p>For the Solr index to work Oak needs to be able to communicate with a Solr instance / cluster.
Apache Solr supports multiple deployment architectures:</p>
<ul>

<li>embedded Solr instance running in the same JVM the client runs into</li>
<li>single remote instance</li>
<li>master / slave architecture, eventually with multiple shards and replicas</li>
<li>SolrCloud cluster, with Zookeeper instance(s) to control a dynamic, resilient set of Solr servers for high
availability and fault tolerance</li>
</ul>
<p>The Oak Solr index can be configured to either use an &#x2018;embedded Solr server&#x2019; or a &#x2018;remote Solr server&#x2019; (being able to
connect to a single remote instance or to a SolrCloud cluster via Zookeeper).</p><section>
<h5><a name="Supported_Solr_deployments"></a>Supported Solr deployments</h5>
<p>Depending on the use case, different Solr server deployments are recommended.</p><section>
<h6><a name="Embedded_Solr_server"></a>Embedded Solr server</h6>
<p>The embedded Solr server is recommended for developing and testing the Solr index for an Oak repository. With that an
in-memory Solr instance is started in the same JVM of the Oak repository, without HTTP bindings (for security purposes
as it'd allow HTTP access to repository data independently of ACLs).
Configuring an embedded Solr server mainly consists of providing the path to a standard <a class="externalLink" href="https://wiki.apache.org/solr/SolrTerminology">Solr home dir</a>
(<i>solr.home.path</i> Oak property) to be used to start Solr; this path can be either relative or absolute, if such a path
would not exist then the default configuration provided with <i>oak-solr-core</i> artifact would be put in the given path.
To start an embedded Solr server with a custom configuration (e.g. different schema.xml / solrconfig.xml than the default
ones) the (modified) Solr home files would have to be put in a dedicated directory, according to Solr home structure, so
that the solr.home.path property can be pointed to that directory.</p></section><section>
<h6><a name="Single_remote_Solr_server"></a>Single remote Solr server</h6>
<p>A single (remote) Solr instance is the simplest possible setup for using the Oak Solr index in a production environment.
Oak will communicate to such a Solr server through Solr's HTTP APIs (via <a class="externalLink" href="http://wiki.apache.org/solr/Solrj">SolrJ</a> client).
Configuring a single remote Solr instance consists of providing the URL to connect to in order to reach the [Solr core]
(<a class="externalLink" href="https://wiki.apache.org/solr/SolrTerminology">https://wiki.apache.org/solr/SolrTerminology</a>) that will host the Solr index for the Oak repository via the <i>solr.http.url</i>
property which will have to contain such a URL (e.g. <i><a class="externalLink" href="http://10.10.1.101:8983/solr/oak">http://10.10.1.101:8983/solr/oak</a></i>).
All the configuration and tuning of Solr, other than what's described on this page, will have to be performed on the
Solr side; <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/tree/trunk/oak-solr-core/src/main/resources/solr/">sample Solr configuration</a>
files (schema.xml, solrconfig.xml, etc.) to start with can be found in <i>oak-solr-core</i> artifact.</p></section><section>
<h6><a name="SolrCloud_cluster"></a>SolrCloud cluster</h6>
<p>A <a class="externalLink" href="https://cwiki.apache.org/confluence/display/solr/SolrCloud">SolrCloud</a> cluster is the recommended setup for an Oak
Solr index in production as it provides a scalable and fault tolerant architecture.
In order to configure a SolrCloud cluster the host of the Zookeeper instance / ensemble managing the Solr servers has
to be provided in the <i>solr.zk.host</i> property (e.g. <i>10.1.1.108:9983</i>) since the SolrJ client for SolrCloud communicates
directly with Zookeeper.
The <a class="externalLink" href="https://wiki.apache.org/solr/SolrTerminology">Solr collection</a> to be used within Oak is named <i>oak</i>, having a replication
factor of 2 and using 2 shards; this means in the default setup the SolrCloud cluster would have to be composed by at
least 4 Solr servers as the index will be split into 2 shards and each shard will have 2 replicas.
SolrCloud also allows the hot deploy of configuration files to be used for a certain collection so while setting up the
collection to be used for Oak with the needed files before starting the cluster, configuration files can also be uploaded
from a local directory, this is controlled by the <i>solr.conf.dir</i> property of the &#x2018;Oak Solr remote server configuration&#x2019;.
For a detailed description of how SolrCloud works see the <a class="externalLink" href="https://cwiki.apache.org/confluence/display/solr/SolrCloud">Solr reference guide</a>.</p></section></section><section>
<h5><a name="OSGi_environment"></a>OSGi environment</h5>
<p>Create an index definition for the Solr index, as described <a href="#Solr_index">above</a>.
Once the query index definition node has been created, access OSGi ConfigurationAdmin via e.g. Apache Felix WebConsole:</p>
<ol style="list-style-type: decimal">

<li>find the &#x2018;Oak Solr indexing / search configuration&#x2019; item and eventually change configuration properties as needed</li>
<li>find either the &#x2018;Oak Solr embedded server configuration&#x2019; or &#x2018;Oak Solr remote server configuration&#x2019; items depending
on the chosen Solr architecture and eventually change configuration properties as needed</li>
<li>find the &#x2018;Oak Solr server provider&#x2019; item and select the chosen provider (&#x2018;remote&#x2019; or &#x2018;embedded&#x2019;)</li>
</ol></section></section><section>
<h4><a name="Advanced_search_features"></a>Advanced search features</h4><section>
<h5><a name="Aggregation"></a>Aggregation</h5>
<p><code>@since Oak 1.1.4, 1.0.13</code></p>
<p>Solr index supports query time aggregation, that can be enabled in OSGi by setting <code>SolrQueryIndexProviderService</code> service
property <code>query.aggregation</code> to true.</p></section><section>
<h5><a name="Suggestions"></a>Suggestions</h5>
<p><code>@since Oak 1.1.17, 1.0.15</code></p>
<p>Default Solr configuration (<a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/resources/solr/oak/conf/solrconfig.xml#L1102">solrconfig.xml</a>
and <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/resources/solr/oak/conf/schema.xml#L119">schema.xml</a>)
comes with a preconfigured suggest component, which uses Lucene's <a class="externalLink" href="https://lucene.apache.org/core/4_7_0/suggest/org/apache/lucene/search/suggest/analyzing/FuzzySuggester.html">FuzzySuggester</a>
under the hood. Updating the suggester in <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/resources/solr/oak/conf/solrconfig.xml#L1110">default configuration</a>
is done every time a <code>commit</code> request is sent to Solr however it's recommended not to do that in production systems if possible,
as it's much better to send explicit request to Solr to rebuild the suggester dictionary, e.g. once a day, week, etc.</p>
<p>More / different suggesters can be configured in Solr, as per <a class="externalLink" href="https://cwiki.apache.org/confluence/display/solr/Suggester">reference documentation</a>.</p></section><section>
<h5><a name="Spellchecking"></a>Spellchecking</h5>
<p><code>@since Oak 1.1.17, 1.0.13</code></p>
<p>Default Solr configuration (<a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/resources/solr/oak/conf/solrconfig.xml#L1177">solrconfig.xml</a>)
comes with a preconfigured spellchecking component, which uses Lucene's <a class="externalLink" href="http://lucene.apache.org/core/4_7_0/suggest/org/apache/lucene/search/spell/DirectSpellChecker.html">DirectSpellChecker</a>
under the hood as it doesn't require any additional data structure neither in RAM nor on disk.</p>
<p>More / different spellcheckers can be configured in Solr, as per <a class="externalLink" href="https://cwiki.apache.org/confluence/display/solr/Spell+Checking">reference documentation</a>.</p></section></section><section>
<h4><a name="Facets"></a>Facets</h4>
<p><code>@since Oak 1.3.14</code></p>
<p>In order to enable proper usage of facets in Solr index the following dynamic field needs to be added to the <i>schema.xml</i></p>

<div class="source"><pre class="prettyprint"><code>    &lt;dynamicField name=&quot;*_facet&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;false&quot; docValues=&quot;true&quot; multiValued=&quot;true&quot;/&gt;
</code></pre></div>
<p>with dedicated <i>copyFields</i> for specific properties.</p>

<div class="source"><pre class="prettyprint"><code>    &lt;copyField source=&quot;jcr:primaryType&quot; dest=&quot;jcr:primaryType_facet&quot;/&gt; &lt;!-- facet on jcr:primaryType field/property --&gt;
</code></pre></div></section><section>
<h4><a name="Persisted_configuration"></a>Persisted configuration</h4>
<p><code>@since Oak 1.4.0</code></p>
<p>It's possible to create (multiple) Solr indexes via persisted configuration.
A persisted Oak Solr index is created whenever an index definition with <i>type = solr</i> has a child node named <i>server</i>
and such a child node has the <i>solrServerType</i> property set (to either <i>embedded</i> or <i>remote</i>).
If no such child node exists, an Oak Solr index will be only created upon explicit registration of a [SolrServerProvider]
e.g. via OSGi.
All the <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/configuration/OakSolrConfiguration.html">OakSolrConfiguration</a>
and <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/configuration/SolrServerConfiguration.html">SolrServerConfiguration</a>
properties are exposed and configurable, see also <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/solr/configuration/nodestate/OakSolrNodeStateConfiguration.java#L245">OakSolrNodeStateConfiguration#Properties</a>
and <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/trunk/oak-solr-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/solr/configuration/nodestate/NodeStateSolrServerConfigurationProvider.java#L94">NodeStateSolrServerConfigurationProvider#Properties</a></p>

<div class="source"><pre class="prettyprint"><code>/oak:index/solrRemote
  - jcr:primaryType = &quot;oak:QueryIndexDefinition&quot;
  - type = &quot;solr&quot;
  - async = &quot;async&quot;
  + server
    - jcr:primaryType = &quot;nt:unstructured&quot;
    - solrServerType = &quot;remote&quot;
    - httpUrl = &quot;http://localhost:8983/solr/oak&quot;
</code></pre></div>
<p>If such configurations exists in the repository the <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/configuration/nodestate/NodeStateSolrServersObserver.html">NodeStateSolrServersObserver</a>
should be registered too (e.g. via <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/index/solr/osgi/NodeStateSolrServersObserverService.html">NodeStateSolrServersObserverService</a>
OSGi service).</p></section><section>
<h4><a name="Notes"></a>Notes</h4>
<p>As of Oak version 1.0.0:</p>
<ul>

<li>Solr index doesn't support search using relative properties, see <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-1835">OAK-1835</a>.</li>
<li>Lucene can only be used for full-text queries, Solr can be used for full-text search <i>and</i> for JCR queries involving
path, property and primary type restrictions.</li>
</ul>
<p>As of Oak version 1.2.0:</p>
<ul>

<li>Solr index doesn't support index time aggregation, but only query time aggregation</li>
<li>Lucene and Solr can be both used for full text, property and path restrictions</li>
</ul></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>