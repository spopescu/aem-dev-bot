<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/security/user/default.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; User Management : The Default Implementation</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../../"  title="Oak logo"><img src="../../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../../license.html" title="License">License</a></li>
            <li><a href="../../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../../migration.html" title="Migration">Migration</a></li>
            <li><a href="../../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../participating.html" title="Participating">Participating</a></li>
            <li><a href="../../testing.html" title="Testing">Testing</a></li>
            <li><a href="../../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">User Management : The Default Implementation <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/security/user/default.md"><img src="../../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../../security/authentication.html" title="Authentication"><span class="icon-chevron-right"></span>Authentication</a></li>
      <li><a href="../../security/authorization.html" title="Authorization"><span class="icon-chevron-right"></span>Authorization</a></li>
      <li><a href="../../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../../security/user.html" title="User Management"><span class="icon-chevron-down"></span>User Management</a>
       <ul class="nav nav-list">
        <li><a href="../../security/user/differences.html" title="Differences"><span class="none"></span>Differences</a></li>
        <li class="active"><a><span class="icon-chevron-down"></span>Default</a>
         <ul class="nav nav-list">
          <li><a href="../../security/user/membership.html" title="Group Membership"><span class="none"></span>Group Membership</a></li>
          <li><a href="../../security/user/authorizableaction.html" title="Authorizable Actions"><span class="none"></span>Authorizable Actions</a></li>
          <li><a href="../../security/user/groupaction.html" title="Group Actions"><span class="none"></span>Group Actions</a></li>
          <li><a href="../../security/user/useraction.html" title="User Actions"><span class="none"></span>User Actions</a></li>
          <li><a href="../../security/user/authorizablenodename.html" title="Node Name Generation"><span class="none"></span>Node Name Generation</a></li>
          <li><a href="../../security/user/expiry.html" title="Password Expiry"><span class="none"></span>Password Expiry</a></li>
          <li><a href="../../security/user/history.html" title="Password History"><span class="none"></span>Password History</a></li>
         </ul></li>
        <li><a href="../../security/user/query.html" title="Query"><span class="none"></span>Query</a></li>
       </ul></li>
     </ul></li>
    <li><a href="../../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<section>
<h2><a name="User_Management_:_The_Default_Implementation"></a>User Management : The Default Implementation</h2><section>
<h3><a name="General_Notes"></a>General Notes</h3>
<p>The default user management implementation stores user/group information in the
content repository. In contrast to Jackrabbit 2.x, which by default used a single,
dedicated workspace for user/group data, this data will as of Oak 1.0 be stored
separately for each JCR workspace.</p>
<p>Consequently, the <code>UserManager</code> associated with the editing sessions, performs
all actions with this editing session. This corresponds to the behavior as defined
the alternative implementation present with Jackrabbit 2.x ((see Jackrabbit 2.x <code>UserPerWorkspaceUserManager</code>).</p>
<ul>

<li>The Oak implementation is build on the Oak API. This allows for double usage as
extension to the JCR API as well as within the Oak layer (aka SPI).</li>
<li>The <code>UserManager</code> is always associated with the same JCR workspace as the editing
<code>Session</code> from which the class has been obtained.</li>
<li>Changes made to the user management API are always transient and require <code>Session#save()</code> to be persisted.</li>
<li>In case of any failure during user management related write operations the API
consumer is in charge of specifically revert pending or invalid transient modifications
or calling <code>Session#refresh(false)</code>.</li>
</ul></section><section>
<h3><a name="Differences_wrt_Jackrabbit_2.x"></a>Differences wrt Jackrabbit 2.x</h3>
<p>A summary of all changes with respect to the former implementation present with
Jackrabbit 2.x is present in the corresponding <a href="differences.html">section</a>.</p></section><section>
<h3><a name="Built-in_Users_and_Special_Groups"></a>Built-in Users and Special Groups</h3>
<p>The setup of builtin user and group accounts is triggered by the configured <code>WorkspaceInitializer</code>
associated with the user management configuration (see Configuration section below).</p>
<p>The default user management implementation in OAK comes with an initializer that
creates the following builtin user accounts:</p><section>
<h4><a name="Administrator"></a>Administrator</h4>
<p>The admin user is always being created. The ID of this user is retrieved from the
user configuration parameter <code>PARAM_ADMIN_ID</code>, which defaults to <code>admin</code>.</p>
<p>As of OAK 1.0 however the administrator user might be created without initial
password forcing the application to set the password upon start (see <code>PARAM_OMIT_ADMIN_PW</code>
configuration parameter).</p><section>
<h5><a name="Anonymous_User"></a>Anonymous User</h5>
<p>In contrast to Jackrabbit 2.x the anonymous (or guest) user is optional. Creation
will be skipped if the value of the <code>PARAM_ANONYMOUS_ID</code> configuration parameter
is <code>null</code> or empty.</p>
<p>Note, that the anonymous user will always be created without specifying a password
in order to prevent regular login with <code>SimpleCredentials</code>.
The proper way to obtain a guest session is:</p>

<div class="source"><pre class="prettyprint"><code>Repository#login(new GuestCredentials(), wspName);
</code></pre></div>
<p>See section <a href="../authentication.html">Authentication</a> for further information about
guest login.</p></section></section><section>
<h4><a name="Everyone_Group"></a>Everyone Group</h4>
<p>The default user management implementation in Oak contains special handling for
the optional group that represents the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/principal/EveryonePrincipal.html#NAME">everyone</a> principal, which is marked by
the reserved principal name and by definition has all other principals as members.</p>
<p>This special group always contains all users/groups as member and cannot be edited
with user management API. As of OAK this fact is consistently reflected in all
group membership related methods. See also <a href="../principal.html">Principal Management</a>.</p></section></section><section>
<h3><a name="User_Management_Operations"></a>User Management Operations</h3><section>
<h4><a name="Reading_Authorizables"></a>Reading Authorizables</h4><section>
<h5><a name="Handling_of_the_Authorizable_ID"></a>Handling of the Authorizable ID</h5>
<ul>

<li>As of Oak 1.0 the node type definition of <code>rep:Authorizable</code> defines a new property <code>rep:authorizableId</code> which is intended to store the ID of a user or group.</li>
<li>This property is protected and system maintained and cannot be changed after creation through user management API calls.</li>
<li>The default implementation comes with a dedicated property index for <code>rep:authorizableId</code> which asserts the uniqueness of that ID.</li>
<li>For backwards compatibility with Jackrabbit 2.x the ID specified during creation is also reflected in the <code>jcr:uuid</code> (protected and mandatory), which is used for the lookup.</li>
<li><code>Authorizable#getID</code> returns the string value contained in <code>rep:authorizableID</code> and for backwards compatibility falls back on the node name in case the <code>rep:authorizableId</code> property is missing.</li>
<li>The name of the authorizable node is generated based on a configurable implementation of the <code>AuthorizableNodeName</code> interface (see configuration section below). By default it uses the ID as name hint and includes a conversion to a valid JCR node name.</li>
</ul></section><section>
<h5><a name="equals.28.29_and_hashCode.28.29"></a>equals() and hashCode()</h5>
<p>The implementation of <code>Object#equals()</code> and <code>Object#hashCode()</code> for user and
groups slightly differs from Jackrabbit 2.x. It no longer relies on the <i>sameness</i>
of the underlaying JCR node but only compares IDs and the user manager instance.</p></section></section><section>
<h4><a name="Creating_Authorizables"></a>Creating Authorizables</h4>
<ul>

<li>The <code>rep:password</code> property is no longer defined to be mandatory. Therefore a new user might be created without specifying a password. Note however, that <code>User#changePassword</code> does not allow to remove the password property.</li>
<li>Since version 1.1.0 Oak supports the new API to create dedicated system users <a class="externalLink" href="https://issues.apache.org/jira/browse/JCR-3802">JCR-3802</a>.</li>
</ul>
<p><a name="query"></a></p></section><section>
<h4><a name="Searching"></a>Searching</h4></section><section>
<h4><a name="XPathQueryBuilder"></a>XPathQueryBuilder</h4>
<p>Oak 1.0 comes with a default XPATH based implementation of the <code>QueryBuilder</code>
interface which is passed to the query upon calling <code>UserManager#findAuthorizables(Query)</code>.</p></section><section>
<h4><a name="Group_Membership"></a>Group Membership</h4>
<p>See section <a href="membership.html">Group Membership</a> for details.</p></section><section>
<h4><a name="Autosave_Behavior"></a>Autosave Behavior</h4>
<p>Due to the nature of the UserManager (see above) we decided to drop the auto-save
behavior in the default implementation present with OAK. Consequently,</p>
<ul>

<li><code>UserManager#autoSave(boolean)</code> throws <code>UnsupportedRepositoryOperationException</code></li>
<li><code>UserManager#isAutoSave()</code> always returns <code>false</code></li>
</ul>
<p>See also <code>PARAM_SUPPORT_AUTOSAVE</code> below; while this should not be needed if
application code has been written against the Jackrabbit API (and thus testing if
auto-save mode is enabled or not) this configuration option can be used as last resort.</p></section><section>
<h4><a name="XML_Import"></a>XML Import</h4>
<p>As of Oak 1.0 user and group nodes can be imported both with Session and Workspace
import. Other differences compared to Jackrabbit 2.x:</p>
<ul>

<li>Importing an authorizable to another tree than the configured user/group node will only failed upon save (-&gt; see <code>UserValidator</code> during the <code>Root#commit</code>). With Jackrabbit 2.x core it used to fail immediately.</li>
<li>The <code>BestEffort</code> behavior is now also implemented for the import of impersonators (was missing in Jackrabbit /2.x).</li>
</ul></section><section>
<h4><a name="Password_Expiry_and_Force_Initial_Password_Change"></a>Password Expiry and Force Initial Password Change</h4>
<p>Since Oak 1.1.0 the default user management and authentication implementation
provides password expiry and initial password change.</p>
<p>By default, these features are disabled. See section <a href="expiry.html">Password Expiry and Force Initial Password Change</a>
for details.</p></section><section>
<h4><a name="Password_History"></a>Password History</h4>
<p>Since Oak 1.3.3 the default user management implementation provides password
history support. By default, this feature is disabled.</p>
<p>See section <a href="history.html">Password History</a> for details.</p></section><section>
<h4><a name="Impersonation"></a>Impersonation</h4>
<p>The default implementation of the <a href="/oak/docs/apidocs/org/apache/jackrabbit/api/security/user/Impersonation.html">Impersonation</a> interface comes with the following limitations and features:</p>
<ul>

<li>only user principals can be granted impersonation</li>
<li>every user can impersonate itself</li>
<li>the admin user always can impersonate all users (and therefore cannot be granted impersonation)</li>
<li>the <a href="#configuration">Configuration</a> allows to define a list of user or group principals that can impersonate all users (since Oak 1.54.0, see <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-10173">OAK-10173</a>)</li>
</ul>
<p><a name="representation"></a></p></section></section><section>
<h3><a name="Representation_in_the_Repository"></a>Representation in the Repository</h3>
<p>The following block lists the built-in node types related to user management tasks:</p>

<div class="source"><pre class="prettyprint"><code>[rep:Authorizable] &gt; mix:referenceable, nt:hierarchyNode
  abstract
  + * (nt:base) = nt:unstructured VERSION
  - rep:principalName  (STRING) protected mandatory
  - rep:authorizableId (STRING) protected /* @since oak 1.0 */
  - * (UNDEFINED)
  - * (UNDEFINED) multiple

[rep:User] &gt; rep:Authorizable, rep:Impersonatable
  + rep:pwd (rep:Password) = rep:Password protected /* @since oak 1.1.0 */
  - rep:password (STRING) protected
  - rep:disabled (STRING) protected

[rep:SystemUser] &gt; rep:User /* @since oak 1.1.0 */

[rep:Impersonatable]
  mixin
  - rep:impersonators (STRING) protected multiple
    
/* @since oak 1.1.0 */
[rep:Password]
  - * (UNDEFINED) protected
  - * (UNDEFINED) protected multiple

[rep:Group] &gt; rep:Authorizable, rep:MemberReferences
  + rep:members (rep:Members) = rep:Members multiple protected VERSION /* @deprecated since oak 1.0 */
  + rep:membersList (rep:MemberReferencesList) = rep:MemberReferencesList protected COPY /* @since oak 1.0 */


[rep:AuthorizableFolder] &gt; nt:hierarchyNode
  + * (rep:Authorizable) = rep:User VERSION
  + * (rep:AuthorizableFolder) = rep:AuthorizableFolder VERSION    

/* @since oak 1.0 */
[rep:MemberReferences]
  - rep:members (WEAKREFERENCE) protected multiple &lt; 'rep:Authorizable'

/* @since oak 1.0 */
[rep:MemberReferencesList]
  + * (rep:MemberReferences) = rep:MemberReferences protected COPY
  
/* @deprecated since oak 1.0 */
[rep:Members]
  orderable
  + * (rep:Members) = rep:Members protected multiple
  - * (WEAKREFERENCE) protected &lt; 'rep:Authorizable'
</code></pre></div>
<p><a name="validation"></a></p></section><section>
<h3><a name="Validation"></a>Validation</h3>
<p>The consistency of this content structure is asserted by a dedicated <code>UserValidator</code>.
The corresponding errors are all of type <code>Constraint</code> with the following codes:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Code</th>
<th>Message</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">0020</td>
<td>Admin user cannot be disabled</td></tr>
<tr class="a">
<td align="left">0021</td>
<td>Invalid jcr:uuid for authorizable (creation)</td></tr>
<tr class="b">
<td align="left">0022</td>
<td>Changing Id, principal name after creation</td></tr>
<tr class="a">
<td align="left">0023</td>
<td>Invalid jcr:uuid for authorizable (mod)</td></tr>
<tr class="b">
<td align="left">0024</td>
<td>Password may not be plain text</td></tr>
<tr class="a">
<td align="left">0025</td>
<td>Attempt to remove id, principalname or pw</td></tr>
<tr class="b">
<td align="left">0026</td>
<td>Mandatory property rep:principalName missing</td></tr>
<tr class="a">
<td align="left">0027</td>
<td>The admin user cannot be removed</td></tr>
<tr class="b">
<td align="left">0028</td>
<td>Attempt to create outside of configured scope</td></tr>
<tr class="a">
<td align="left">0029</td>
<td>Intermediate folders not rep:AuthorizableFolder</td></tr>
<tr class="b">
<td align="left">0030</td>
<td>Missing uuid for group (check for cyclic membership)</td></tr>
<tr class="a">
<td align="left"><s>0031</s></td>
<td><s>Cyclic group membership</s> (see <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-6072">OAK-6072</a>)</td></tr>
<tr class="b">
<td align="left">0032</td>
<td>Attempt to set password with system user</td></tr>
<tr class="a">
<td align="left">0033</td>
<td>Attempt to add rep:pwd node to a system user</td></tr>
</tbody>
</table>
<p><a name="configuration"></a></p></section><section>
<h3><a name="Configuration"></a>Configuration</h3>
<p>The following user management specific methods are present with the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/user/UserConfiguration.html">UserConfiguration</a>
as of OAK 1.0:</p>
<ul>

<li>getUserManager: Obtain a new user manager instance</li>
</ul><section>
<h4><a name="Configuration_Parameters_supported_by_the_default_implementation"></a>Configuration Parameters supported by the default implementation</h4>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th></tr>
</thead><tbody>

<tr class="b">
<td align="left"><code>PARAM_ADMIN_ID</code></td>
<td>String</td>
<td colspan="2">&#x201c;admin&#x201d;</td></tr>
<tr class="a">
<td align="left"><code>PARAM_OMIT_ADMIN_PW</code></td>
<td>boolean</td>
<td colspan="2">false</td></tr>
<tr class="b">
<td align="left"><code>PARAM_ANONYMOUS_ID</code></td>
<td>String</td>
<td colspan="2">&#x201c;anonymous&#x201d; (nullable)</td></tr>
<tr class="a">
<td align="left"><code>PARAM_USER_PATH</code></td>
<td>String</td>
<td colspan="2">&#x201c;/rep:security/rep:authorizables/rep:users&#x201d;</td></tr>
<tr class="b">
<td align="left"><code>PARAM_GROUP_PATH</code></td>
<td>String</td>
<td colspan="2">&#x201c;/rep:security/rep:authorizables/rep:groups&#x201d;</td></tr>
<tr class="a">
<td align="left"><code>PARAM_DEFAULT_DEPTH</code></td>
<td>int</td>
<td colspan="2">2</td></tr>
<tr class="b">
<td align="left"><code>PARAM_PASSWORD_HASH_ALGORITHM</code></td>
<td>String</td>
<td colspan="2">&#x201c;SHA-256&#x201d;</td></tr>
<tr class="a">
<td align="left"><code>PARAM_PASSWORD_HASH_ITERATIONS</code></td>
<td>int</td>
<td colspan="2">1000</td></tr>
<tr class="b">
<td align="left"><code>PARAM_PASSWORD_SALT_SIZE</code></td>
<td>int</td>
<td colspan="2">8</td></tr>
<tr class="a">
<td align="left"><code>PARAM_AUTHORIZABLE_NODE_NAME</code></td>
<td>AuthorizableNodeName</td>
<td colspan="2">AuthorizableNodeName#DEFAULT</td></tr>
<tr class="b">
<td align="left"><code>PARAM_AUTHORIZABLE_ACTION_PROVIDER</code></td>
<td>AuthorizableActionProvider</td>
<td colspan="2">DefaultAuthorizableActionProvider</td></tr>
<tr class="a">
<td align="left"><code>PARAM_SUPPORT_AUTOSAVE</code></td>
<td>boolean</td>
<td colspan="2">false</td></tr>
<tr class="b">
<td align="left"><code>PARAM_IMPORT_BEHAVIOR</code></td>
<td>String (&#x201c;abort&#x201d;, &#x201c;ignore&#x201d;, &#x201c;besteffort&#x201d;)</td>
<td colspan="2">&#x201c;ignore&#x201d;</td></tr>
<tr class="a">
<td align="left"><code>PARAM_PASSWORD_MAX_AGE</code></td>
<td>int</td>
<td colspan="2">0</td></tr>
<tr class="b">
<td align="left"><code>PARAM_PASSWORD_INITIAL_CHANGE</code></td>
<td>boolean</td>
<td colspan="2">false</td></tr>
<tr class="a">
<td align="left"><code>PARAM_PASSWORD_HISTORY_SIZE</code></td>
<td>int (upper limit: 1000)</td>
<td colspan="2">0</td></tr>
<tr class="b">
<td align="left"><code>PARAM_CACHE_EXPIRATION</code></td>
<td>long</td>
<td>0</td>
<td>Number of milliseconds until the internal <a href="../principal/cache.html">principal cache</a> expires. If not set or equal/lower than zero no cache is created/evaluated.</td></tr>
<tr class="a">
<td align="left"><code>PARAM_ENABLE_RFC7613_USERCASE_MAPPED_PROFILE</code></td>
<td>boolean</td>
<td colspan="2">false</td></tr>
<tr class="b">
<td align="left"><code>PARAM_IMPERSONATOR_PRINCIPAL_NAMES</code></td>
<td>String</td>
<td>{}</td>
<td>List of users who can impersonate and groups whose members can impersonate any user (since Oak 1.54.0, <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-10173">OAK-10173</a>).</td></tr>
</tbody>
</table>
<p>The following configuration parameters present with the default implementation in Jackrabbit 2.x are no longer supported and will be ignored:</p>
<ul>

<li><code>compatibleJR16</code></li>
<li><code>autoExpandTree</code></li>
<li><code>autoExpandSize</code></li>
<li><code>groupMembershipSplitSize</code></li>
</ul>
<p>The optional <code>cacheExpiration</code> configuration option listed above is discussed in
detail in section <a href="../principal/cache.html">Caching Results of Principal Resolution</a>.
It is not related to user management s.str. but affects the implementation
specific <code>PrincipalProvider</code> implementation exposed by <code>UserConfiguration.getUserPrincipalProvider</code>.</p>
<p><a name="pluggability"></a></p></section></section><section>
<h3><a name="Pluggability"></a>Pluggability</h3>
<p>Within the default user management implementation the following parts can be
modified or extended at runtime by providing corresponding OSGi services or passing
appropriate configuration parameters exposing the custom implementations:</p>
<ul>

<li><code>AuthorizableActionProvider</code>: Defines the authorizable actions, see <a href="authorizableaction.html">Authorizable Actions</a>.</li>
<li><code>AuthorizableNodeName</code>: Defines the generation of the authorizable node names
in case the user management implementation stores user information in the repository.
See <a href="authorizablenodename.html">Authorizable Node Name Generation</a>.</li>
<li><code>UserAuthenticationFactory</code>: see below</li>
</ul><section>
<h4><a name="UserAuthenticationFactory_:_Authenticating_Users"></a>UserAuthenticationFactory : Authenticating Users</h4>
<p>Since Oak 1.1.5 the default user management implementation allows to configure
and thus replace the default <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/user/UserAuthenticationFactory.html">UserAuthenticationFactory</a>, which links the user
management implementation with the authentication (specifically the <a href="../authentication/default.html#user_authentication">uid/pw-login</a>)
as it exposes the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/Authentication.html">Authentication</a> implementation to be used for verification
of the specified credentials according to details provided by a given user management
implementation.</p><section>
<h5><a name="Examples"></a>Examples</h5><section>
<h6><a name="Example_UserAuthenticationFactory"></a>Example UserAuthenticationFactory</h6>

<div class="source"><pre class="prettyprint"><code>@Component()
@Service(UserAuthenticationFactory.class)
public class MyUserAuthenticationFactory implements UserAuthenticationFactory {

    private Set&lt;String&gt; ids = Collections.emptySet();

    public MyUserAuthenticationFactory() {}

    //--------------------------------------&lt; UserAuthenticationFactory &gt;---
    @Override
    Authentication getAuthentication(@Nonnull UserConfiguration configuration, @Nonnull Root root, @Nullable String userId) {
        final boolean canAuthenticate = (userId != null &amp;&amp; ids.contains(userId));
        return new Authentication() {
            @Override
            public boolean authenticate(@Nullable Credentials credentials) {
                return canAuthenticate;
            }
        };
    }

    //------------------------------------------------&lt; SCR Integration &gt;---
    @Activate
    private void activate(Map&lt;String, Object&gt; properties) {
         ids = ImmutableSet.copyOf(PropertiesUtil.toStringArray(properties.get(&quot;ids&quot;), new String[0]));
    }
}
</code></pre></div><!-- hidden references --></section></section></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>