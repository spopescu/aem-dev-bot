<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/security/authentication/default.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Authentication : Implementation Details</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../../"  title="Oak logo"><img src="../../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../../license.html" title="License">License</a></li>
            <li><a href="../../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../../migration.html" title="Migration">Migration</a></li>
            <li><a href="../../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../participating.html" title="Participating">Participating</a></li>
            <li><a href="../../testing.html" title="Testing">Testing</a></li>
            <li><a href="../../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Authentication : Implementation Details <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/security/authentication/default.md"><img src="../../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../../security/authentication.html" title="Authentication"><span class="icon-chevron-down"></span>Authentication</a>
       <ul class="nav nav-list">
        <li><a href="../../security/authentication/differences.html" title="Differences"><span class="none"></span>Differences</a></li>
        <li class="active"><a><span class="none"></span>Default</a></li>
        <li><a href="../../security/authentication/preauthentication.html" title="Pre-Authentication"><span class="none"></span>Pre-Authentication</a></li>
        <li><a href="javascript:void(0)" title="Extensions"><span class="icon-chevron-down"></span>Extensions</a>
         <ul class="nav nav-list">
          <li><a href="../../security/authentication/tokenmanagement.html" title="Token"><span class="none"></span>Token</a></li>
          <li><a href="../../security/authentication/externalloginmodule.html" title="External"><span class="icon-chevron-right"></span>External</a></li>
         </ul></li>
       </ul></li>
      <li><a href="../../security/authorization.html" title="Authorization"><span class="icon-chevron-right"></span>Authorization</a></li>
      <li><a href="../../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<section>
<h2><a name="Authentication_:_Implementation_Details"></a>Authentication : Implementation Details</h2><section>
<h3><a name="General"></a>General</h3>
<p>Jackrabbit Oak covers different authentication requirements by providing default
implementations and extension points for different setup scenarios.</p></section><section>
<h3><a name="Differences_wrt_Jackrabbit_2.x"></a>Differences wrt Jackrabbit 2.x</h3>
<p>See the corresponding <a href="differences.html">documentation</a>.</p></section><section>
<h3><a name="Authentication_Requirements"></a>Authentication Requirements</h3>
<p>Jackrabbit Oak covers the following login requirements and provides
dedicated <code>LoginModule</code> implementation(s) for each scenario:</p>
<ul>

<li><a href="#guest">Guest Login</a></li>
<li><a href="#uid_pw">UserId/Password Login</a></li>
<li><a href="#impersonation">Impersonation Login</a></li>
<li><a href="#token">Token Login</a></li>
<li><a href="#pre_authenticated">Pre-Authenticated Login</a></li>
<li><a href="#external">External Login</a></li>
</ul>
<p><a name="guest"></a></p><section>
<h4><a name="Guest_Login"></a>Guest Login</h4>
<p>The proper way to obtain a guest session is specified by JSR 283:</p>

<div class="source"><pre class="prettyprint"><code>String wspName = null; // or any other workspace name if not login to the default workspace
Session anonymous = repository.login(new GuestCredentials(), wspName);
</code></pre></div>
<p>As of Oak 1.0 <code>Repository#login()</code> and <code>Repository#login(null, wspName)</code> is no longer treated as guest login. This behavior of Jackrabbit-core is violating the specification, which defines that null-login should be used for those cases where the authentication process is handled outside the repository (see <a href="preauthentication.html">Pre-Authentication</a>).</p>
<p>Similarly, any special treatment that Jackrabbit core applied for the guest (anonymous) user has been omitted altogether from the default <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.html">LoginModuleImpl</a>. By default, the built-in anonymous user will be created without any password. Therefore, explicitly uid/pw login using the anonymous userId will no longer work. This behavior is now consistent with the default login of any other user which doesn't have a password set.</p><section>
<h5><a name="GuestLoginModule"></a>GuestLoginModule</h5>
<p>The aim of the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/GuestLoginModule.html">GuestLoginModule</a> implementation is to provide backwards compatibility
with Jackrabbit 2.x with respect to the guest (anonymous) login: the <code>GuestLoginModule</code>
can be added as <i>optional</i> entry to the chain of login modules in the JAAS (or
corresponding OSGi) configuration.</p>
<p>Example JAAS Configuration:</p>

<div class="source"><pre class="prettyprint"><code>jackrabbit.oak {
   org.apache.jackrabbit.oak.spi.security.authentication.GuestLoginModule  optional;
   org.apache.jackrabbit.oak.security.authentication.user.LoginModuleImpl required;
};
</code></pre></div>
<p>The behavior of the <code>GuestLoginModule</code> is as follows:</p>
<p><i>Phase 1: Login</i></p>
<ul>

<li>tries to retrieve JCR credentials from the <a href="/oak/docs/apidocs/javax/security/auth/callback/CallbackHandler.html">CallbackHandler</a> using the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/callback/CredentialsCallback.html">CredentialsCallback</a></li>
<li>in case no credentials could be obtained it pushes a new instance of <a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/GuestCredentials.html">GuestCredentials</a> to the shared stated
and <b>returns</b> <code>true</code></li>
<li>otherwise it <b>returns</b> <code>false</code></li>
</ul>
<p><i>Phase 2: Commit</i></p>
<ul>

<li>if the phase 1 succeeded it will add the <code>GuestCredentials</code> created above and
<code>EveryonePrincipal</code> the <code>Subject</code> in phase 2 of the login process and <b>returns</b> <code>true</code></li>
<li>otherwise it <b>returns</b> <code>false</code></li>
</ul>
<p><a name="uid_pw"></a></p></section></section><section>
<h4><a name="UserId.2FPassword_Login"></a>UserId/Password Login</h4>
<p>Oak 1.0 comes with 2 different login module implementations that can handle
<a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/SimpleCredentials.html">SimpleCredentials</a>:</p>
<ul>

<li>Default (<code>LoginModuleImpl</code>) as described below</li>
<li><code>ExternalLoginModule</code> as described in section <a href="externalloginmodule.html">External Authentication</a></li>
</ul><section>
<h5><a name="LoginModuleImpl"></a>LoginModuleImpl</h5>
<p>The <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.html">LoginModuleImpl</a> defines a regular userId/password login and requires a
repository setup that supports <a href="../user.html">User Management</a> and is designed to
supports the following <code>Credentials</code>:</p>
<ul>

<li><code>SimpleCredentials</code></li>
<li><code>GuestCredentials</code> (see above)</li>
<li><code>ImpersonationCredentials</code> (see below)</li>
</ul>
<p>This login module implementations behaves as follows:</p>
<p><i>Phase 1: Login</i></p>
<ul>

<li>if a user does not exist in the repository (i.e. cannot be provided by the user manager) it <b>returns <code>false</code></b>.</li>
<li>if an authorizable with the respective userId exists but is a group or a disabled users, it <b>throws <code>LoginException</code></b></li>
<li>if a user exists in the repository and the credentials don't match, it <b>throws <code>LoginException</code></b></li>
<li>if a user exists in the repository and the credentials match, it <b>returns <code>true</code></b>
<ul>

<li>also, it adds the credentials to the shared state</li>
<li>also, it adds the login name to the shared state</li>
<li>also, it calculates the principals and adds them to the private state</li>
<li>also, it adds the credentials to the private state</li>
</ul>
</li>
</ul>
<p><i>Phase 2: Commit</i></p>
<ul>

<li>if the private state contains the credentials and principals, it adds them (both) to the subject and <b>returns <code>true</code></b></li>
<li>if the private state does not contain credentials and principals, it clears the state and <b>returns <code>false</code></b></li>
</ul>
<p><a name="user_authentication"></a></p><section>
<h6><a name="User_Authentication"></a>User Authentication</h6>
<p>The <code>LoginModuleImpl</code> uses a configured <code>Authentication</code>-implementation for
performing the login step. Which implementation to use is determined by the
<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/user/UserAuthenticationFactory.html">UserAuthenticationFactory</a> obtained by the given <code>UserConfiguration</code>. It is
expected to provide an <code>Authentication</code> implementation if the given
<code>UserConfiguration</code> is accepted.</p>
<p>In case multiple implementations of the <code>UserAuthenticationFactory</code> are available,
the precedence depends on its OSGi service ranking property. The default factory
implementation has a ranking of 0 (OSGi default). Services with the highest ranking
will take precedence.</p>
<p>See also section <a href="../user/default.html#pluggability">user management</a>.</p>
<p><a name="impersonation"></a></p></section></section></section><section>
<h4><a name="Impersonation_Login"></a>Impersonation Login</h4>
<p>Another flavor of the Oak authentication implementation is covered by <code>javax.jcr.Session#impersonate(Credentials)</code>, which allows to obtain a new <code>Session</code> for a user identified by the specified credentials. As of JSR 333 this method can also be used in order to clone the existing session (i.e. self-impersonation of the user that holds the session).</p>
<p>With Oak 1.0 impersonation is implemented as follows:</p>
<ol style="list-style-type: decimal">

<li><code>Session#impersonate</code> takes any kind of <code>Credentials</code></li>
<li>the specified credentials are wrapped in a new instance of <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/ImpersonationCredentials.html">ImpersonationCredentials</a>
along with the current <code>AuthInfo</code> object.</li>
<li>these <code>ImpersonationCredentials</code> are passed to <code>Repository.login</code></li>
</ol>
<p>If impersonation succeeds consequently both depends on the authentication
setup and on some implementation specific validation that make sure the
editing session is allowed to impersonate the user identified by the credentials
passed to the impersonate call.</p>
<p>With Oak 1.0 only the default login module (<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.html">LoginModuleImpl</a>) is able to deal
with <code>ImpersonationCredentials</code> and applies the following logic:</p>
<ul>

<li><b>Self-Impersonation</b>: Any attempt to impersonate the same session will succeed
as long as the user is still valid (i.e. exists and has not been disabled).</li>
<li><b>Regular Impersonation</b>: Impersonation another user will only succeed if
the impersonated user is valid (i.e. exists and is not disabled) <i>and</i> the
user associated with the editing session is allowed to impersonate this
user. The latter depends on the <a href="../user.html">User Management</a> implementation
specifically on the return value of <code>User.getImpersonation().allows(Subject subject)</code>. See <a href="../user/default.html">User Management : The Default Implementation</a> for details.</li>
</ul><section>
<h5><a name="ImpersonationCredentials"></a>ImpersonationCredentials</h5>
<p>Since the implementation of <code>Session.impersonate</code> no longer uses <code>SimpleCredentials</code>
to transport the original <code>Subject</code> but rather performs the login with dedicated
<a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/ImpersonationCredentials.html">ImpersonationCredentials</a>, impersonation is no longer restricted to <code>SimpleCredentials</code>
being passed to <code>Session#impersonate</code> call. Instead, the specified credentials are
passed to a new instance of <code>ImpersonationCredentials</code> delegating the evaluation
and validation of the specified <code>Credentials</code> to the configured login module(s).</p>
<p>This modification will not affect applications that used JCR API to impersonate
a given session. Note however that applications relying on the Jackrabbit
implementation and manually creating <code>SimpleCredentials</code> with a
<code>SecurityConstants.IMPERSONATOR_ATTRIBUTE</code>, would need to be refactored after
migration to Oak.</p></section><section>
<h5><a name="Impersonation_with_Custom_Authentication_Setup"></a>Impersonation with Custom Authentication Setup</h5>
<p>Applications that wish to use a custom authentication setup need to ensure the
following steps in order to get JCR impersonation working:</p>
<ul>

<li>Respect <code>ImpersonationCredentials</code> in the authentication setup.</li>
<li>Identify the impersonated from <code>ImpersonationCredentials.getBaseCredentials</code>and verify if it can be authenticated.</li>
<li>Validate that the editing session is allowed to impersonate: The user associated with the editing session can be identified by the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/api/AuthInfo.html">AuthInfo</a> obtained from <code>ImpersonationCredentials.getImpersonatorInfo()</code>.</li>
</ul>
<p><a name="token"></a></p></section></section><section>
<h4><a name="Token_Login"></a>Token Login</h4>
<p>See section <a href="tokenmanagement.html">Token Authentication</a> for details regarding token based authentication.</p><section>
<h5><a name="TokenLoginModule"></a>TokenLoginModule</h5>
<p>The <code>TokenLoginModule</code> is in charge of creating new login tokens and validate repository logins with <code>TokenCredentials</code>. The exact behavior of this login module is described in section <a href="tokenmanagement.html">Token Authentication</a>.</p>
<p><a name="pre_authenticated"></a></p></section></section><section>
<h4><a name="Pre-Authenticated_Login"></a>Pre-Authenticated Login</h4>
<p>Oak provides two different mechanisms to create pre-authentication that doesn't involve the repositories internal authentication mechanism for credentials validation.</p>
<ul>

<li>Pre-Authentication combined with Login Module Chain</li>
<li>Pre-Authentication without Repository Involvement (aka <code>null</code> login)</li>
</ul>
<p>See section <a href="preauthentication.html">Pre-Authentication Login</a> for
further details and examples.</p>
<p><a name="external"></a></p></section><section>
<h4><a name="External_Login"></a>External Login</h4>
<p>While the default setup in Oak is solely relying on repository functionality to
ensure proper authentication it quite common to authenticate against different
systems (e.g. LDAP). For those setups that wish to combine initial authentication
against a third party system with repository functionality, Oak provides a default
implementation with extension points:</p>
<ul>

<li><a href="externalloginmodule.html">External Authentication</a>: Summary of the external authentication and details about the <code>ExternalLoginModule</code>.</li>
<li><a href="usersync.html">User and Group Synchronization</a>: Details regarding user and group synchronization as well as a list of configuration options available with the default implementations present with Oak.</li>
<li><a href="identitymanagement.html">Identity Management</a>: Further information regarding external identity management.</li>
<li><a href="ldap.html">LDAP Integration</a>: How to make use of the <code>ExternalLoginModule</code> with the LDAP identity provider implementation. This combination is aimed to replace <code>com.day.crx.security.ldap.LDAPLoginModule</code>, which relies on Jackrabbit internals and will no longer work with Oak.</li>
</ul><section>
<h5><a name="ExternalLoginModule"></a>ExternalLoginModule</h5>
<p>The <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/security/authentication/external/ExternalLoginModule.html">ExternalLoginModule</a> is a base implementation that allows easy integration
of 3rd party authentication and identity systems, such as <a href="ldap.html">LDAP</a>. The
general mode of the external login module is to use the external system as authentication
source and as a provider for users and groups that may also be synchronized into
the repository.</p>
<p>This login module implementation requires a valid <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/external/SyncHandler.html">SyncHandler</a> and <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authentication/external/IdentityProvider.html">IdentityProvider</a> to be present. The detailed behavior of the <code>ExternalLoginModule</code> is described in section <a href="externalloginmodule.html">External Authentication</a>.</p><!-- hidden references --></section></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>