<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/security/authorization/composite.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Combining Multiple Authorization Models</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../../"  title="Oak logo"><img src="../../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../../license.html" title="License">License</a></li>
            <li><a href="../../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../../migration.html" title="Migration">Migration</a></li>
            <li><a href="../../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../participating.html" title="Participating">Participating</a></li>
            <li><a href="../../testing.html" title="Testing">Testing</a></li>
            <li><a href="../../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Combining Multiple Authorization Models <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/security/authorization/composite.md"><img src="../../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../../security/authentication.html" title="Authentication"><span class="icon-chevron-right"></span>Authentication</a></li>
      <li><a href="../../security/authorization.html" title="Authorization"><span class="icon-chevron-down"></span>Authorization</a>
       <ul class="nav nav-list">
        <li><a href="../../security/accesscontrol.html" title="Access Control Management"><span class="icon-chevron-right"></span>Access Control Management</a></li>
        <li><a href="../../security/permission.html" title="Permission Evaluation"><span class="icon-chevron-right"></span>Permission Evaluation</a></li>
        <li><a href="../../security/privilege.html" title="Privilege Management"><span class="icon-chevron-right"></span>Privilege Management</a></li>
        <li><a href="javascript:void(0)" title="Extensions"><span class="icon-chevron-down"></span>Extensions</a>
         <ul class="nav nav-list">
          <li><a href="../../security/authorization/restriction.html" title="Restrictions"><span class="none"></span>Restrictions</a></li>
          <li class="active"><a><span class="none"></span>Multiple Models</a></li>
          <li><a href="../../security/authorization/cug.html" title="Closed User Groups"><span class="none"></span>Closed User Groups</a></li>
          <li><a href="../../security/authorization/principalbased.html" title="Principal Based"><span class="none"></span>Principal Based</a></li>
         </ul></li>
       </ul></li>
      <li><a href="../../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<section>
<h2><a name="Combining_Multiple_Authorization_Models"></a>Combining Multiple Authorization Models</h2><section>
<h3><a name="General_Notes"></a>General Notes</h3>
<p>Since Oak 1.4 it is possible to combine multiple authorization models within the
default security setup.</p>
<p>The main entry point for the aggregation of multiple authorization models is the
<a class="externalLink" href="https://github.com/apache/jackrabbit-oak/tree/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/composite/CompositeAuthorizationConfiguration.java">CompositeAuthorizationConfiguration</a>, which is in charge of generating composite
variants of the <code>AccessControlManager</code>, <code>PermissionProvider</code> and <code>RestrictionProvider</code>
if multiple authorization modules have been configured (see section <a href="#details">Implementation Details</a> below.</p>
<p><i>Please note:</i>
Despite the fact that Oak supports the aggregation of multiple authorization
models, this extension is only recommended for experts that have in-depth
knowledge and understanding of Jackrabbit/Oak authorization concepts. Doing so
might otherwise result in severe security issues and heavily impact overall performance.</p>
<p><a name="api_extensions"></a></p></section><section>
<h3><a name="API_Extensions"></a>API Extensions</h3>
<p>There are two interfaces required to make a given authorization model deployable
in an aggregated setup:</p>
<ul>

<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/accesscontrol/PolicyOwner.html">PolicyOwner</a>: Extension to the <code>AccessControlManager</code>, that allows a given implementation to claim responsibility for handling certain <code>AccessControlPolicy</code> implementations.</li>
<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/permission/AggregatedPermissionProvider.html">AggregatedPermissionProvider</a>: Subclass of <code>PermissionProvider</code> which is mandated for permission evaluation once multiple providers are configured.</li>
<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/permission/AggregationFilter.html">AggregationFilter</a>: Optional add-on to cancel the aggregation (since Oak 1.16)</li>
</ul><section>
<h4><a name="PolicyOwner"></a>PolicyOwner</h4>
<p>Interface defining a single method, which allows to identify the <code>AccessControlManager</code>
implementation responsible set or removing a given policy. <code>AccessControlManager</code>s
deployed in a composite authorization setup are required to implement this interface
<i>if</i> they choose to support <i>setPolicy</i> or <i>removePolicy</i>. Omitting the <code>PolicyOwner</code>
interface will most likely result in a <code>AccessControlException</code> as no policy owner
can be found for the given type of policy.</p></section><section>
<h4><a name="AggregatedPermissionProvider"></a>AggregatedPermissionProvider</h4>
<p>Extension of the <code>PermissionProvider</code> interface that allows a given provider to
be deployed in a composite authorization setup. The additional methods allow the
aggregating provider to identify if a given <code>PermissionProvider</code> can handle permission
evaluation for a given set of permissions at a given path.</p><section>
<h5><a name="Example"></a>Example</h5>
<p>The permission provider shipped with the <a href="cug.html#details">oak-authorization-cug</a> module
has a very limited scope: it only evaluates read-access to regular items at the
configured supported paths. This means e.g. that the implementation is not able to
determine if write access is granted to a given set of <code>Principal</code>s and indicates
this fact by just returning the subset of supported read permissions upon
<code>supportedPermissions(Tree, PropertyState, long)</code>. The aggregated permission provider
will consequently not consult this implementation for the evaluation of write
permissions and move on to other providers in the aggregate.</p></section></section><section>
<h4><a name="AggregationFilter"></a>AggregationFilter</h4>
<p>Oak 1.16 introduces an optional add-on that allows for further refine the permission evaluation (and computation of
effective policies). Specifically, the interface <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/permission/AggregationFilter.html">AggregationFilter</a> provides the ability to conditionally stop the
aggregation process.</p><section>
<h5><a name="Example"></a>Example</h5>
<p>The example permission provider present with the <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/tree/trunk/oak-exercise/src/main/java/org/apache/jackrabbit/oak/exercise/security/authorization/models/simplifiedroles/ThreeRolesAuthorizationConfiguration.java">ThreeRolesAuthorizationConfiguration</a> in <i>oak-exercise</i> will for a given
configured subtree apply the following roles to a given <code>Subject</code>: no-access, reader, editor and owner. For any path
outside of the configure tree this model takes no effect.
If this module were to be deployed to an Oak repository installation that already combines CUG-authorization with the
default authorization, the aggregated permission evaluation mechanism would require all authorization models to grant
permissions below that subtree. This essentially mandates redundant permission setup with all models. An custom <code>AggregationFilter</code>
however would allow to cancel the aggregation once <code>ThreeRolesPermissionProvider</code> completed the evaluation for a given
set of principals but would leave aggregation intact otherwise (i.e. permission evaluation outside of the configured path
where <code>ThreeRolesPermissionProvider</code> is not invoked or for principals that don't match the criteria).</p>
<p>See also <a href="principalbased.html#details_aggregationfilter">Managing Access by Principal</a> for an implementation example.</p>
<p><a name="details"></a></p></section></section></section><section>
<h3><a name="Implementation_Details"></a>Implementation Details</h3>
<p>As soon as multiple authorization models are configured with the security setup,
the <code>CompositeAuthorizationConfiguration</code> will return a dedicated <code>JackrabbitAccessControlManager</code>
and <code>PermissionProvider</code> that are wrapping the objects provided by the aggregated
implementations.</p>
<p>Note: as long as a single authorization model is configured (default setup) the
<code>CompositeAuthorizationConfiguration</code> will omit any extra wrapping.</p><section>
<h4><a name="Access_Control"></a>Access Control</h4>
<p>Once multiple modules are deployed a <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/tree/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/composite/CompositeAccessControlManager.java">CompositeAccessControlManager</a> with the following
characteristics will be returned:</p>
<ul>

<li>API calls reading information will return the combined result of the wrapped implementations.</li>
<li>Methods defined solely by <code>JackrabbitAccessControlManager</code> additionally test for the delegatees to implement that extension.</li>
<li>API calls writing back policies will look for the responsible <code>PolicyOwner</code> and specifically delegate the call. If no owner can be found an <code>AccessControlException</code> is thrown.</li>
</ul>
<p>Hence, a given authorization model is free to implement JCR <code>AccessControlManager</code>
or the Jackrabbit extension.</p>
<p>If a given model allows for writing access control policies, the access control manager
implementation must additionally implement the <code>PolicyOwner</code> interface as explained in
section <a href="#api_extensions">API Extensions</a> above.</p></section><section>
<h4><a name="Permission_Evaluation"></a>Permission Evaluation</h4>
<p>Only models implementing the <code>AggregatedPermissionProvider</code> extensions will be
respected for aggregation into the <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/tree/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/composite/CompositePermissionProvider.java">CompositePermissionProvider</a>. This allows
individual models to cover only a subset of permissions and|or a subset of paths
within the repository.</p>
<p>The composite wrapper subsequently applies the following logic to evaluate the
effective permissions:</p>
<ul>

<li>each delegatee is in ask to evaluate the subset of supported permissions if it
claims responsible for the given item/path,</li>
<li>a delegatee that doesn't handle any of the permissions in question it is ignored,</li>
<li>a delegatee that doesn't claim responsible for the item/path is ignored,</li>
<li>a given set of permissions is ultimately granted for a given item/path, if <i>all</i>
permissions have been successfully processed and none of the delegatees involved
denied access.</li>
</ul>
<p>This implies that evaluation of permissions across multiple implementations is
strictly additive: as soon as one provider denies access (either by an explicit
deny or by a missing explicit allow) permissions are denied.</p>
<p>Similarly, if a given combination of permission providers fails to process the
complete set of permissions (e.g. one permission is not covered by any of the modules)
the access will be denied as none of the provider was in charge of proper evaluation.</p>
<p>For a given permission provider this means: Calling the same method outside of
the context of the aggregation (i.e. single model setup), a &#x2018;limited&#x2019; provider must
never grant access for permissions or items it isn't able to handle properly.
In other words: permissions that have not been explicitly granted within the scope
of an implementation must be denied.</p></section><section>
<h4><a name="Restriction_Management"></a>Restriction Management</h4>
<p>Support for multiple restriction providers has already been been present with the
default authorization implementation since Oak 1.0. The mechanism described in
section <a href="restriction.html">Restriction Management</a> is not affected by the new functionality.</p>
<p>The <code>CompositeAuthorizationConfiguration</code> is in charge of collecting
the <code>RestrictionProvider</code>s from the aggregated modules and expose the complete
set of restrictions in order to meet the API contract.</p>
<p>Nevertheless, each authorization model is responsible for exposing, validating and
evaluating the subset of restrictions it can handle through the access control API
extensions and the permission evaluation, respectively. A given model may decide to
provide no support for restrictions. Examples include modules that deal with different
types of <code>AccessControlPolicy</code> where restriction management doesn't apply (see for example <a href="cug.html#details">oak-authorization-cug</a>).</p>
<p><a name="configuration"></a></p></section></section><section>
<h3><a name="Configuration"></a>Configuration</h3>
<p>By default the <code>CompositeAuthorizationConfiguration</code> aggregates results by applying an <code>AND</code> operation to the current set of providers.
This can be changed via configuration to an <code>OR</code>. See section <a href="../../introduction.html#configuration">Introduction to Oak Security</a> for further details.</p>
<p><a name="pluggability"></a></p></section><section>
<h3><a name="Pluggability"></a>Pluggability</h3>
<p>The following steps are required to plug an additional authorization model into
the Oak repository:</p>
<ul>

<li>Implement your custom <code>AuthorizationConfiguration</code></li>
<li>Deploy the bundle containing the implementation</li>
<li>Bind your <code>AuthorizationConfiguration</code> to the <code>SecurityProvider</code>:
<ul>

<li>in an OSGi setup this is achieved by adding the configuration to the
<code>requiredServicePids</code> property of the <code>SecurityProviderRegistration</code> <i>(&#x201c;Apache Jackrabbit Oak SecurityProvider&#x201d;)</i>
i.e. forcing the recreation of the <code>SecurityProvider</code>.</li>
<li>in a non-OSGi setup this requires adding the configuration
to the <code>SecurityProvider</code> (e.g. <i>SecurityProviderBuilder.newBuilder().with(params).build()</i>)
and subsequently creating the JCR/Oak repository object.</li>
</ul>
</li>
</ul>
<p><b>Important Note</b><br />
Despite the fact that Oak supports the aggregation of multiple authorization
models, this extension is only recommended for experts that have in-depth
knowledge and understanding of Jackrabbit/Oak authorization concepts. Doing so
might otherwise result in severe security issues and heavily impact overall performance.</p><!-- hidden references --></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>