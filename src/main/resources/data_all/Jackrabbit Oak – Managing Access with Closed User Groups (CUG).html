<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/security/authorization/cug.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Managing Access with Closed User Groups (CUG)</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script src="../../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../../"  title="Oak logo"><img src="../../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../../license.html" title="License">License</a></li>
            <li><a href="../../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../../migration.html" title="Migration">Migration</a></li>
            <li><a href="../../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../../participating.html" title="Participating">Participating</a></li>
            <li><a href="../../testing.html" title="Testing">Testing</a></li>
            <li><a href="../../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Managing Access with Closed User Groups (CUG) <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/security/authorization/cug.md"><img src="../../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../../security/authentication.html" title="Authentication"><span class="icon-chevron-right"></span>Authentication</a></li>
      <li><a href="../../security/authorization.html" title="Authorization"><span class="icon-chevron-down"></span>Authorization</a>
       <ul class="nav nav-list">
        <li><a href="../../security/accesscontrol.html" title="Access Control Management"><span class="icon-chevron-right"></span>Access Control Management</a></li>
        <li><a href="../../security/permission.html" title="Permission Evaluation"><span class="icon-chevron-right"></span>Permission Evaluation</a></li>
        <li><a href="../../security/privilege.html" title="Privilege Management"><span class="icon-chevron-right"></span>Privilege Management</a></li>
        <li><a href="javascript:void(0)" title="Extensions"><span class="icon-chevron-down"></span>Extensions</a>
         <ul class="nav nav-list">
          <li><a href="../../security/authorization/restriction.html" title="Restrictions"><span class="none"></span>Restrictions</a></li>
          <li><a href="../../security/authorization/composite.html" title="Multiple Models"><span class="none"></span>Multiple Models</a></li>
          <li class="active"><a><span class="none"></span>Closed User Groups</a></li>
          <li><a href="../../security/authorization/principalbased.html" title="Principal Based"><span class="none"></span>Principal Based</a></li>
         </ul></li>
       </ul></li>
      <li><a href="../../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<section>
<h2><a name="Managing_Access_with_.E2.80.9CClosed_User_Groups.E2.80.9D_.28CUG.29"></a>Managing Access with &#x201c;Closed User Groups&#x201d; (CUG)</h2><section>
<h3><a name="General"></a>General</h3>
<p>The <code>oak-authorization-cug</code> module provides an alternative authorization model
intended to limit read access to certain paths for a selected, small set of
<code>Principal</code>s.</p>
<p>These restricted areas called <code>CUG</code> are marked by a dedicated policy type and
effectively prevent read-access for anybody not explicitly allowed.</p>
<p>This implies that the CUG-authorization model solely evaluates and enforces read
access to regular nodes and properties. Therefore it may only be used as an additional,
complementary authorization scheme while the primary module(s) is/are in charge
of enforcing the complete set of permissions including read/write access,
repository operations and any kind of special permissions like reading and
writing access control content. See section <a href="composite.html">Combining Multiple Authorization Models</a>
for information aggregating access control management and permission evaluation
from different implementations.</p>
<p>By default the <code>oak-authorization-cug</code> model is disabled and it requires
manual <a href="#configuration">configuration</a> steps in order to plug it into the Oak
security setup.</p>
<p>Once deployed this authorization configuration can be used in the following two
operation modes:</p>
<ol style="list-style-type: decimal">

<li>Evaluation disabled: Access control management is supported and policies may
be applied to the repository without taking effect.</li>
<li>Evaluation enabled: All policies edited and applied by this module will take
effect upon being persisted, i.e. access to items located in a restricted are
will be subject to the permission evaluation associated with the authorization model.</li>
</ol>
<p><a name="jackrabbit_api"></a></p></section><section>
<h3><a name="Jackrabbit_API"></a>Jackrabbit API</h3>
<p>The Jackrabbit API defines an extension of the JCR <a class="externalLink" href="https://s.apache.org/jcr-2.0-javadoc/javax/jcr/security/AccessControlPolicy.html">AccessControlPolicy</a> interface
intended to grant the ability to perform certain actions to a set of
<a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/security/Principal.html">Principal</a>s:</p>
<ul>

<li><code>PrincipalSetPolicy</code></li>
</ul>
<p>See <a class="externalLink" href="http://jackrabbit.apache.org/api/2.12/index.html?org/apache/jackrabbit/api/security/authorization/PrincipalSetPolicy.html">Jackrabbit API</a>
for details and the methods exposed by the interface.</p>
<p><a name="api_extensions"></a></p></section><section>
<h3><a name="API_Extensions"></a>API Extensions</h3>
<p>The module comes with the following extension in the
<code>org.apache.jackrabbit.oak.spi.security.authorization.cug</code> package space:</p>
<ul>

<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/cug/CugPolicy.html">CugPolicy</a></li>
<li><a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/cug/CugExclude.html">CugExclude</a></li>
</ul><section><section>
<h5><a name="CugPolicy"></a>CugPolicy</h5>
<p>The <code>CugPolicy</code> interface extends the <code>PrincipalSetPolicy</code> and <code>JackrabbitAccessControlPolicy</code>
interfaces provided by Jackrabbit API. It comes with the following set of methods that allow to
read and modify the set of <code>Principal</code>s that will be allowed to access the restricted
area defined by a given policy instance.</p>

<div class="source"><pre class="prettyprint"><code>CugPolicy extends PrincipalSetPolicy, JackrabbitAccessControlPolicy
   
   Set&lt;Principal&gt; getPrincipals();       
   boolean addPrincipals(@Nonnull Principal... principals) throws AccessControlException;       
   boolean removePrincipals(@Nonnull Principal... principals) throws AccessControlException;
</code></pre></div></section><section>
<h5><a name="CugExclude"></a>CugExclude</h5>
<p>The <code>CugExclude</code> allows to customize the set of principals excluded from evaluation
of the restricted areas. These principals will consequently never be prevented
from accessing any of the configured CUGs and read permission evaluation is
delegated to any other module present in the setup.</p>
<p>The feature ships with two implementations out of the box:</p>
<ul>

<li><code>CugExclude.Default</code>: Default implementation that excludes admin, system and
system-user principals. It will be used as fallback if no other implementation is configured.</li>
<li><code>CugExcludeImpl</code>: OSGi service extending from the default that additionally
allows to excluded principals by their names at runtime.</li>
</ul>
<p>See also section <a href="#pluggability">Pluggability</a> below.</p>
<p><a name="details"></a></p></section></section></section><section>
<h3><a name="Implementation_Details"></a>Implementation Details</h3><section>
<h4><a name="Access_Control_Management"></a>Access Control Management</h4>
<p>The access control management part of the CUG authorization models follows the
requirements defined by JSR 283 and the extensions defined by Jackrabbit API (see section
<a href="../accesscontrol.html">Access Control Management</a> with the following characterstics:</p><section>
<h5><a name="Supported_Privileges"></a>Supported Privileges</h5>
<p>This implemenation of the <code>JackrabbitAccessControlManager</code> only supports a subset of
privileges, namely <code>jcr:read</code>, <code>rep:readProperties</code>, <code>rep:readNodes</code>.</p></section><section>
<h5><a name="Access_Control_Policies"></a>Access Control Policies</h5>
<p>Only a single type of access control policies (<code>CugPolicy</code>) is exposed and accepted
by the access control manager. Once effective each CUG policy creates a restricted
area starting at the target node and inherited to the complete subtree defined
therein.</p>
<p>Depending on the value of the mandatory <code>PARAM_CUG_SUPPORTED_PATHS</code> <a href="#configuration">configuration</a>
option creation (and evaluation) of CUG policies can be limited to
certain paths within the repository. Within these supported paths CUGs can
be nested. Note however, that the principal set defined with a given <code>CugPolicy</code>
is not inherited to the nested policies applied in the subtree.</p>
<p><i>Note:</i> For performance reasons it is recommended to limited the usage of <code>CugPolicy</code>s
to a single or a couple of subtrees in the repository.</p></section><section>
<h5><a name="Management_by_Principal"></a>Management by Principal</h5>
<p>Given the fact that a given CUG policy takes effect for all principals present in
the system, access control management by <code>Principal</code> is not supported currently.
The corresponding Jackrabbit API methods always return an empty policy array.</p></section></section><section>
<h4><a name="Permission_Evaluation"></a>Permission Evaluation</h4>
<p>As stated above evaluation of the restricted areas requires the <code>PARAM_CUG_ENABLED</code>
<a href="#configuration">configuration</a> option to be set to <code>true</code>. This switch allows to
setup restricted areas in a staging enviroment and only let them take effect in
the public facing production instance.</p>
<p>If permission evaluation is enabled, the <code>PermissionProvider</code> implementation associated
with the authorization model will prevent read access to all restricted areas
defined by a <code>CugPolicy</code>. Only <code>Principal</code>s explicitly allowed by the policy itself
or the globally configured <code>CugExclude</code> will be granted read permissions to the
affected items in the subtree.</p>
<p>For example, applying and persisting a new <code>CugPolicy</code> at path <i>/content/restricted/apache_foundation</i>,
setting the principal names to <i>apache-members</i> and <i>jackrabbit-pmc</i> will prevent
read access to the tree defined by this path for all <code>Subject</code>s that
doesn't match any of the two criteria:</p>
<ul>

<li>the <code>Subject</code> contains<code>Principal</code> <i>apache-members</i> and|or <i>jackrabbit-pmc</i> (as defined in the <code>CugPolicy</code>)</li>
<li>the <code>Subject</code> contains at least one <code>Principal</code> explicitly excluded from CUG evaluation in the configured, global <code>CugExclude</code></li>
</ul>
<p>This further implies that the <code>PermissionProvider</code> will only evaluate regular read
permissions (i.e. <code>READ_NODE</code> and <code>READ_PROPERTY</code>). Evaluation of any other
<a href="../permission.html#oak_permissions">permissions</a> including reading the cug policy
node (access control content) is consequently delegated to other
authorization modules. In case there was no module dealing with these permissions,
access will be denied (see in section <i>Combining Multiple Authorization Models</i> for <a href="composite.html#details">details</a>).</p></section><section>
<h4><a name="Permission_Evaluation_with_Multiplexed_Stores"></a>Permission Evaluation with Multiplexed Stores</h4>
<p>The CUG authorization module is not designed to be used in combination with non-default mounts. If any of the configured
supported paths (see below) is found to be an ancestor of any non-default mount or included therein the activation/modification
of the <code>CugConfiguration</code> will fail with immediately and log an error.</p>
<p><a name="representation"></a></p></section></section><section>
<h3><a name="Representation_in_the_Repository"></a>Representation in the Repository</h3>
<p>CUG policies defined by this module in a dedicate node name <code>rep:cugPolicy</code> of
type <code>rep:CugPolicy</code>. This node is defined by a dedicate mixin type
<code>rep:CugMixin</code> (similar to <code>rep:AccessControllable</code>) and has a single mandatory,
protected property which stores the name of principals that are granted read
access in the restricted area:</p>

<div class="source"><pre class="prettyprint"><code>[rep:CugMixin]
  mixin
  + rep:cugPolicy (rep:CugPolicy) protected IGNORE
  
[rep:CugPolicy] &gt; rep:Policy
  - rep:principalNames (STRING) multiple protected mandatory IGNORE
</code></pre></div>
<p><i>Note:</i> the multivalued <code>rep:principalNames</code> property reflects the fact
that CUGs are intended to be used for small principal sets, preferably
<code>java.security.acl.Group</code> principals.</p>
<p><a name="validation"></a></p></section><section>
<h3><a name="Validation"></a>Validation</h3>
<p>The consistency of this content structure both on creation and modification is
asserted by a dedicated <code>CugValidatorProvider</code>. The corresponding error are
all of type <code>AccessControl</code> with the following codes:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Code</th>
<th>Message</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">0020</td>
<td>Attempt to change primary type of/to cug policy</td></tr>
<tr class="a">
<td align="left">0021</td>
<td>Wrong primary type of &#x2018;rep:cugPolicy&#x2019; node</td></tr>
<tr class="b">
<td align="left">0022</td>
<td>Access controlled not not of mixin &#x2018;rep:CugMixin&#x2019;</td></tr>
<tr class="a">
<td align="left">0023</td>
<td>Wrong name of node with primary type &#x2018;rep:CugPolicy&#x2019;</td></tr>
</tbody>
</table>
<p><a name="configuration"></a></p></section><section>
<h3><a name="Configuration"></a>Configuration</h3>
<p>The CUG authorization extension is an optional feature that requires mandatory
configuration: this includes defining the supported paths and enabling the
permission evaluation.</p><section>
<h4><a name="Configuration_Parameters"></a>Configuration Parameters</h4>
<p>The <code>org.apache.jackrabbit.oak.spi.security.authorization.cug.impl.CugConfiguration</code>
supports the following configuration parameters:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th></tr>
</thead><tbody>

<tr class="b">
<td align="left"><code>PARAM_CUG_ENABLED</code></td>
<td>boolean</td>
<td>false</td>
<td>Flag to enable evaluation of CUG policies upon read-access.</td></tr>
<tr class="a">
<td align="left"><code>PARAM_CUG_SUPPORTED_PATHS</code></td>
<td>Set&lt;String&gt;</td>
<td>-</td>
<td>Paths under which CUGs can be created and will be evaluated.</td></tr>
<tr class="b">
<td align="left"><code>PARAM_RANKING</code></td>
<td>int</td>
<td>200</td>
<td>Ranking within the composite authorization setup.</td></tr>
<tr class="a">
<td align="left"> </td>
<td> </td>
<td> </td>
<td> </td></tr>
</tbody>
</table>
<p><i>Note:</i> depending on other the authorization models deployed in the composite
setup, the number of CUGs used in a given deployment as well as other
factors such as predominant read vs. read-write, the performance of overall
permission evaluation may benefit from changing the default ranking of the
CUG authorization model.</p></section><section>
<h4><a name="Excluding_Principals"></a>Excluding Principals</h4>
<p>The CUG authorization setup can be further customized by configuring the
<code>CugExcludeImpl</code> service with allows to list additional principals that need
to be excluded from the evaluation of restricted areas:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th></tr>
</thead><tbody>

<tr class="b">
<td align="left"><code>principalNames</code></td>
<td>Set&lt;String&gt;</td>
<td>-</td>
<td>Name of principals that are always excluded from CUG evaluation.</td></tr>
<tr class="a">
<td align="left"> </td>
<td> </td>
<td> </td>
<td> </td></tr>
</tbody>
</table>
<p><i>Note:</i> This implementation extends the <a href="/oak/docs/apidocs/org/apache/jackrabbit/oak/spi/security/authorization/cug/CugExclude.Default.html">default</a>
exclusion list. Alternatively, it is possible to plug a custom <code>CugExclude</code> implementation matching
specific needs (see <a href="#pluggability">below</a>).</p>
<p><a name="pluggability"></a></p></section></section><section>
<h3><a name="Pluggability"></a>Pluggability</h3>
<p>The following section describes how to deploy the CUG authorization model into
an Oak repository and how to customize the <code>CugExclude</code> extension point.</p>
<p><i>Note:</i> the reverse steps can be used to completely disable the CUG
authorization model in case it is not needed for a given repository
installation but shipped by a vendor such as e.g. Adobe AEM 6.3.</p><section>
<h4><a name="Deploy_CugConfiguration"></a>Deploy CugConfiguration</h4><section>
<h5><a name="OSGi_Setup"></a>OSGi Setup</h5>
<p>The following steps are required in order to deploy the CUG authorization model
in an OSGi-base Oak repository:</p>
<ol style="list-style-type: decimal">

<li>Deploy the <code>oak-authorization-cug</code> bundle</li>
<li>Activate the <code>CugConfiguration</code> <i>(&#x201c;Apache Jackrabbit Oak CUG Configuration&#x201d;)</i> by providing the desired component configuration (<i>ConfigurationPolicy.REQUIRE</i>)</li>
<li>Find the <code>SecurityProviderRegistration</code> <i>(&#x201c;Apache Jackrabbit Oak SecurityProvider&#x201d;)</i> configuration and
enter <i><code>org.apache.jackrabbit.oak.spi.security.authorization.cug.impl.CugConfiguration</code></i> as additional value to the <code>requiredServicePids</code> property.</li>
</ol>
<p>The third step will enforce the recreation of the <code>SecurityProvider</code> and hence
trigger the <code>RepositoryInitializer</code> provided by the CUG authorization module.</p></section><section>
<h5><a name="Non-OSGi_Setup"></a>Non-OSGi Setup</h5>
<p>The following example shows a simplified setup that contains the <code>CugConfiguration</code>
as additional authorization model (second position in the aggregation). See also
unit tests for an alternative approach.</p>

<div class="source"><pre class="prettyprint"><code> // setup CugConfiguration
 ConfigurationParameters params = ConfigurationParameters.of(AuthorizationConfiguration.NAME,
         ConfigurationParameters.of(ConfigurationParameters.of(
                 CugConstants.PARAM_CUG_SUPPORTED_PATHS, &quot;/content&quot;,
                 CugConstants.PARAM_CUG_ENABLED, true)));
 CugConfiguration cug = new CugConfiguration();
 cug.setParameters(params);
 
 // bind it to the security provider
 SecurityProvider securityProvider = SecurityProviderBuilder.newBuilder().with(configuration).build();
 
 CompositeConfiguration&lt;AuthorizationConfiguration&gt; composite = (CompositeConfiguration) securityProvider
       .getConfiguration(AuthorizationConfiguration.class);
 AuthorizationConfiguration defConfig = composite.getDefaultConfig();
 
 cug.setSecurityProvider(securityProvider);
 cug.setRootProvider(((ConfigurationBase) defConfig).getRootProvider());
 cug.setTreeProvider(((ConfigurationBase) defConfig).getTreeProvider());
 composite.addConfiguration(cug);
 composite.addConfiguration(defConfig);
 
 // create the Oak repository (alternatively: create the JCR repository)
 Oak oak = new Oak()
         .with(new InitialContent())
         // TODO: add all required editors
         .with(securityProvider);
         withEditors(oak);
 ContentRepository contentRepository = oak.createContentRepository();
</code></pre></div></section></section><section>
<h4><a name="Customize_CugExclude"></a>Customize CugExclude</h4>
<p>The following steps are required in order to customize the <code>CugExclude</code> implementation
in a OSGi-based repository setup. Ultimately the implementation needs to be referenced
in the <code>org.apache.jackrabbit.oak.spi.security.authorization.cug.impl.CugConfiguration</code>.</p>
<ol style="list-style-type: decimal">

<li>implement <code>CugExclude</code> interface according to you needs,</li>
<li>make your implementation an OSGi service</li>
<li>deploy the bundle containing your implementation in the OSGi container and activate the service.</li>
<li>make sure the default CUGExclude service is properly replaced by the custom implementation.</li>
</ol><section><section>
<h6><a name="Example"></a>Example</h6>

<div class="source"><pre class="prettyprint"><code>@Component()
@Service(CugExclude.class)
public class MyCugExclude implements CugExclude {

    private static final Principal PRINCIPAL_APACHE_MEMBERS = new PrincipalImpl(&quot;apache-members&quot;);
    private static final Principal PRINCIPAL_JACKRABBIT_PMC = new PrincipalImpl(&quot;jackrabbit_pmc&quot;);

    public MyCugExclude() {}

    //-----------------------------------------------------&lt; CugExclude &gt;---
    @Override
    public boolean isExcluded(@Nonnull Set&lt;Principal&gt; principals) {
        return principals.contains(PRINCIPAL_APACHE_MEMBERS) || principals.contains(PRINCIPAL_JACKRABBIT_PMC);
    }

    //------------------------------------------------&lt; SCR Integration &gt;---
    @Activate
    private void activate(Map&lt;String, Object&gt; properties) {
    }
}
</code></pre></div><!-- hidden references --></section></section></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>