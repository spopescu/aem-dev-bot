<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/nodestore/documentmk.md at 2024-06-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Jackrabbit Oak &#x2013; Oak Document Storage</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
                _paq.push(['disableCookies']);
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
        
        (function() {
            var u="https://analytics.apache.org";
            _paq.push(['setTrackerUrl', u+'/matomo.php']);
            _paq.push(['setSiteId', '4']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/apache/jackrabbit-oak" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="../"  title="Oak logo"><img src="../oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="../license.html" title="License">License</a></li>
            <li><a href="../downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="../roadmap.html" title="Roadmap">Roadmap</a></li>
            <li><a href="../articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="../architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" title="JCR API">JCR API</a></li>
            <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" title="Jackrabbit API">Jackrabbit API</a></li>
            <li><a href="../oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="../nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../plugins/blobstore.html" title="Blob Storage">Blob Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="../features/direct-binary-access.html" title="Direct Binary Access">Direct Binary Access</a></li>
                  <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File">Direct Binary Access Upload File</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="../query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="../query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="../query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="../query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run">Indexing with Oak-Run</a></li>
                  <li><a href="../query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="../query/elastic.html" title="Elastic Index">Elastic Index</a></li>
                  <li><a href="../query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="../query/hybrid-index.html" title="Hybrid Index">Hybrid Index</a></li>
                  <li><a href="../query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../security/overview.html" title="Security">Security</a>
              <ul class="dropdown-menu">
                  <li><a href="../security/introduction.html" title="Introduction">Introduction</a></li>
                  <li><a href="../security/reports.html" title="Reports">Reports</a></li>
                  <li><a href="../security/authentication.html" title="Authentication">Authentication</a></li>
                  <li><a href="../security/authorization.html" title="Authorization">Authorization</a></li>
                  <li><a href="../security/principal.html" title="Principal Management">Principal Management</a></li>
                  <li><a href="../security/user.html" title="User Management">User Management</a></li>
              </ul>
            </li>
            <li><a href="../features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="../features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="../osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="../command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="../migration.html" title="Migration">Migration</a></li>
            <li><a href="../differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="../known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="../constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="../dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="../coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="../FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="../participating.html" title="Participating">Participating</a></li>
            <li><a href="../testing.html" title="Testing">Testing</a></li>
            <li><a href="../oakathons.html" title="Oakathons">Oakathons</a></li>
            <li><a href="../developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="../branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="../attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="../release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Oak Documentation</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="https://jackrabbit.apache.org/" class="externalLink" title="Jackrabbit">Jackrabbit</a><span class="divider">/</span></li>
      <li class=""><a href="https://jackrabbit.apache.org/oak/docs/" class="externalLink" title="Oak">Oak</a><span class="divider">/</span></li>
    <li class="active ">Oak Document Storage <a href="https://github.com/apache/jackrabbit-oak/edit/trunk/oak-doc/src/site/markdown/nodestore/documentmk.md"><img src="../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right">Last Published: 2024-06-11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../articles.html" title="Articles"><span class="none"></span>Articles</a></li>
   <li class="nav-header">Concepts and Architecture</li>
    <li><a href="../architecture/overview.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a></li>
   <li class="nav-header">Main APIs</li>
    <li><a href="https://s.apache.org/jcr-2.0-spec/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a></li>
    <li><a href="https://jackrabbit.apache.org/jcr/jcr-api.html" class="externalLink" title="Jackrabbit API"><span class="none"></span>Jackrabbit API</a></li>
    <li><a href="../oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a></li>
   <li class="nav-header">Features and Plugins</li>
    <li><a href="../nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
     <ul class="nav nav-list">
      <li class="active"><a><span class="icon-chevron-down"></span>Document NodeStore</a>
       <ul class="nav nav-list">
        <li><a href="../nodestore/document/mongo-document-store.html" title="MongoDB DocumentStore"><span class="none"></span>MongoDB DocumentStore</a></li>
        <li><a href="../nodestore/document/rdb-document-store.html" title="RDB DocumentStore"><span class="none"></span>RDB DocumentStore</a></li>
        <li><a href="../nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a></li>
        <li><a href="../nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a></li>
        <li><a href="../nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a></li>
        <li><a href="../clustering.html" title="Clustering"><span class="none"></span>Clustering</a></li>
       </ul></li>
      <li><a href="../nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a></li>
      <li><a href="../nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a></li>
     </ul></li>
    <li><a href="../plugins/blobstore.html" title="Blob Storage"><span class="icon-chevron-down"></span>Blob Storage</a>
     <ul class="nav nav-list">
      <li><a href="../features/direct-binary-access.html" title="Direct Binary Access"><span class="none"></span>Direct Binary Access</a></li>
      <li><a href="../features/direct-binary-access-upload-file.html" title="Direct Binary Access Upload File"><span class="none"></span>Direct Binary Access Upload File</a></li>
     </ul></li>
    <li><a href="../query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
     <ul class="nav nav-list">
      <li><a href="../query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a></li>
      <li><a href="../query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a></li>
      <li><a href="../query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a></li>
      <li><a href="../query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a></li>
      <li><a href="../query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a></li>
      <li><a href="../query/oak-run-indexing.html" title="Indexing with Oak-Run"><span class="none"></span>Indexing with Oak-Run</a></li>
      <li><a href="../query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a></li>
      <li><a href="../query/elastic.html" title="Elastic Index"><span class="none"></span>Elastic Index</a></li>
      <li><a href="../query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a></li>
      <li><a href="../query/hybrid-index.html" title="Hybrid Index"><span class="none"></span>Hybrid Index</a></li>
      <li><a href="../query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a></li>
     </ul></li>
    <li><a href="../security/overview.html" title="Security"><span class="icon-chevron-down"></span>Security</a>
     <ul class="nav nav-list">
      <li><a href="../security/introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
      <li><a href="../security/reports.html" title="Reports"><span class="none"></span>Reports</a></li>
      <li><a href="../security/authentication.html" title="Authentication"><span class="icon-chevron-right"></span>Authentication</a></li>
      <li><a href="../security/authorization.html" title="Authorization"><span class="icon-chevron-right"></span>Authorization</a></li>
      <li><a href="../security/principal.html" title="Principal Management"><span class="icon-chevron-right"></span>Principal Management</a></li>
      <li><a href="../security/user.html" title="User Management"><span class="icon-chevron-right"></span>User Management</a></li>
     </ul></li>
    <li><a href="../features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a></li>
    <li><a href="../features/observation.html" title="Observation"><span class="none"></span>Observation</a></li>
   <li class="nav-header">Using Oak</li>
    <li><a href="../use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a></li>
    <li><a href="../osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a></li>
    <li><a href="../command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a></li>
    <li><a href="../migration.html" title="Migration"><span class="none"></span>Migration</a></li>
    <li><a href="../differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a></li>
    <li><a href="../known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a></li>
    <li><a href="../constraints.html" title="Constraints"><span class="none"></span>Constraints</a></li>
    <li><a href="../dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a></li>
    <li><a href="../coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a></li>
    <li><a href="../FAQ.html" title="FAQ"><span class="none"></span>FAQ</a></li>
   <li class="nav-header">Developing Oak</li>
    <li><a href="../dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../participating.html" title="Participating"><span class="none"></span>Participating</a></li>
    <li><a href="../testing.html" title="Testing"><span class="none"></span>Testing</a></li>
    <li><a href="../oakathons.html" title="Oakathons"><span class="none"></span>Oakathons</a></li>
    <li><a href="../developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a></li>
    <li><a href="../diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a></li>
    <li><a href="../branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a></li>
    <li><a href="../attribution.html" title="Attribution"><span class="none"></span>Attribution</a></li>
    <li><a href="../release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a></li>
   <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a></li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="jackrabbit.apache.org/oak/docs/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  -->
<h1>Oak Document Storage</h1>
<ul>

<li><a href="#oak-document-storage">Oak Document Storage</a>
<ul>

<li><a href="#new-1.10">New in 1.10</a></li>
<li><a href="#new-1.8">New in 1.8</a></li>
<li><a href="#new-1.6">New in 1.6</a></li>
<li><a href="#backend-implementations">Backend implementations</a></li>
<li><a href="#content-model">Content Model</a>
<ul>

<li><a href="#node-content-model">Node Content Model</a></li>
<li><a href="#revisions">Revisions</a></li>
<li><a href="#commit-root">Commit Root</a></li>
<li><a href="#branches">Branches</a></li>
<li><a href="#sweep-revision">Sweep Revision</a></li>
<li><a href="#previous-documents">Previous Documents</a></li>
</ul>
</li>
<li><a href="#clock-requirements">Clock requirements</a></li>
<li><a href="#node-bundling">Node Bundling</a></li>
<li><a href="#background-operations">Background Operations</a>
<ul>

<li><a href="#renew-cluster-id-lease">Renew Cluster Id Lease</a></li>
<li><a href="#background-document-split">Background Document Split</a></li>
<li><a href="#background-writes">Background Writes</a></li>
<li><a href="#bg-read">Background Reads</a></li>
</ul>
</li>
<li><a href="#metrics">Metrics and Monitoring</a></li>
<li><a href="#cluster-node-metadata">Cluster Node Metadata</a>
<ul>

<li><a href="#acquire-a-cluster-node-id">Acquire a Cluster Node ID</a></li>
<li><a href="#update-lease-for-a-cluster-node-id">Update Lease for a Cluster Node ID</a></li>
<li><a href="#recovery-for-a-cluster-node-id">Recovery for a Cluster Node ID</a></li>
<li><a href="#rw-preference">Specifying the Read Preference and Write Concern</a></li>
</ul>
</li>
<li><a href="#cache">Caching</a>
<ul>

<li><a href="#cache-invalidation">Cache Invalidation</a></li>
<li><a href="#cache-configuration">Cache Configuration</a></li>
</ul>
</li>
<li><a href="#unlockUpgrade">Unlock upgrade</a></li>
<li><a href="#revision-gc">Revision Garbage Collection</a></li>
<li><a href="#pending-topics">Pending Topics</a>
<ul>

<li><a href="#conflict-detection-and-handling">Conflict Detection and Handling</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>One of the plugins in Oak stores data in a document oriented format.
The plugin implements the low level <code>NodeStore</code> interface.</p>
<p>The document storage optionally uses the <a href="persistent-cache.html">persistent cache</a>
to reduce read operations on the backend storage.</p><section>
<h2><a name="New_in_1.10"></a><a name="new-1.10"></a> New in 1.10</h2>
<ul>

<li>Use of MongoDB client sessions. See also <a href="document/mongo-document-store.html#read-preference">read preference</a>.</li>
<li><a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-7316">Greedy cluster node info</a>. See also <a href="#acquire-a-cluster-node-id">Acquire a Cluster Node ID</a>.</li>
</ul></section><section>
<h2><a name="New_in_1.8"></a><a name="new-1.8"></a> New in 1.8</h2>
<ul>

<li><a href="#sweep-revision">Sweep Revision</a></li>
<li><a href="#unlockUpgrade">Unlock upgrade</a></li>
<li><a href="#revision-gc">Continuous and oak-run triggered Revision GC</a></li>
</ul></section><section>
<h2><a name="New_in_1.6"></a><a name="new-1.6"></a> New in 1.6</h2>
<ul>

<li><a href="#node-bundling">Node Bundling</a></li>
<li><a href="#secondary-store">Secondary Store</a></li>
</ul></section><section>
<h2><a name="Backend_implementations"></a><a name="backend-implementations"></a> Backend implementations</h2>
<p>The DocumentNodeStore supports a number of backends, with a storage abstraction
called <code>DocumentStore</code>:</p>
<ul>

<li><a href="document/mongo-document-store.html"><code>MongoDocumentStore</code></a>: stores documents in a MongoDB.</li>
<li><a href="document/rdb-document-store.html"><code>RDBDocumentStore</code></a>: stores documents in a relational data base.</li>
<li><code>MemoryDocumentStore</code>: keeps documents in memory. This implementation should only be used for testing purposes.</li>
</ul>
<p>The remaining part of the document will focus on the <code>MongoDocumentStore</code> to
explain and illustrate concepts of the DocumentNodeStore.</p></section><section>
<h2><a name="Content_Model"></a><a name="content-model"></a> Content Model</h2>
<p>The repository data is stored in two collections: the <code>nodes</code> collection for
node data, and the <code>blobs</code> collection for binaries. The <code>journal</code> collection
contains a log of changes applied to the repository. Entries older than 24 hours
are automatically purged by the repository.</p>
<p>The <code>clusterNodes</code> collection contains a document for each DocumentNodeStore
connected to MongoDB in read-write mode. A DocumentNodeStore uses the documents
in this collection to discover all other instances.</p>
<p>Cluster wide information is stored in the <code>settings</code> collection. This includes
checkpoints, journal and revision GC status, format version and the current
cluster view.</p>
<p>The data can be viewed using the MongoDB shell:</p>

<div class="source"><pre class="prettyprint"><code>&gt; show collections
blobs
clusterNodes
journal
nodes
settings
</code></pre></div><section>
<h3><a name="Node_Content_Model"></a><a name="node-content-model"></a> Node Content Model</h3>
<p>The <code>DocumentNodeStore</code> stores each node in a separate MongoDB document and updates to
a node are stored by adding new revision/value pairs to the document. This way
the previous state of a node is preserved and can still be retrieved by a
session looking at a given snapshot (revision) of the repository.</p>
<p>The basic MongoDB document of a node in Oak looks like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_id&quot; : &quot;1:/node&quot;,
    &quot;_deleted&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;false&quot;
    },
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13f3875b5d1-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1371041805),
    &quot;_modCount&quot; : NumberLong(1),
    &quot;_children&quot; : Boolean(true),
    &quot;_revisions&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;c&quot;
    }
}
</code></pre></div>
<p>All fields in the above document are metadata and are not exposed through the
Oak API. The DocumentNodeStore has two types of fields. Simple fields are key/value pairs
like the <code>_id</code> or <code>_modified</code> field. Versioned fields are kept in sub-documents
where the key is a revision paired with the value at this revision.</p>
<p>The <code>_id</code> field is used as the primary key and consists of a combination of the
depth of the path and the path itself. This is an optimization to align sibling
keys in the index.</p>
<p>The <code>_deleted</code> sub-document contains the revision this node was created in. In
the above example the root node was created in revision <code>r13f3875b5d1-0-1</code>. If
the node is later deleted, the <code>_deleted</code> sub-document will get a new field with
the revision the node was deleted in.</p>
<p>The sub-document <code>_lastRev</code> contains the last revision written to this node by
each cluster node. In the above example the DocumentNodeStore cluster node with id <code>1</code>
modified the node the last time in revision <code>r13f3875b5d1-0-1</code>, when it created
the node. The revision key in the <code>_lastRev</code> sub-document is synthetic and the
only information actually used by the DocumentNodeStore is the clusterId. The <code>_lastRev</code>
sub-document is only updated for non-branch commits or on merge, when changes
become visible to all readers. Starting with Oak 1.2 the <code>_lastRev</code> value for
a cluster node is only updated when there is no corresponding entry in <code>_revisions</code>
or <code>_commitRoot</code>. That is, when the node wasn't changed but a descendant node
was added, removed or modified.</p>
<p>The <code>_modified</code> field contains an indexed low-resolution timestamp when the node
was last modified. The time resolution is five seconds. This field is also updated
when a branch commit modifies a node.</p>
<p>The <code>_modCount</code> field contains a modification counter, which is incremented with
every change to the document. This field allows the DocumentNodeStore to perform
conditional updates without requesting the whole document.</p>
<p>The <code>_children</code> field is a boolean flag to indicate if this node has child nodes. By
default a node would not have this field. If any node gets added as child of this node
then it would be set to true. It is used to optimize access to child nodes and allows
the DocumentNodeStore to omit calls to fetch child nodes for leaf nodes.</p>
<p>Finally, the <code>_revisions</code> sub-document contains commit information about changes
marked with a revision. E.g. the single entry in the above document tells us
that everything marked with revision <code>r13f3875b5d1-0-1</code> is committed and
therefore valid. In case the change is done in a branch then the value would be the
base revision. It is only added for those nodes which happen to be the commit root
for any given commit.</p>
<p>Adding a property <code>prop</code> with value <code>foo</code> to the node in a next step will
result in the following document:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;false&quot;
    },
    &quot;_id&quot; : &quot;1:/node&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13f38818ab6-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1371042580),
    &quot;_modCount&quot; : NumberLong(2),
    &quot;_revisions&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;c&quot;,
        &quot;r13f38818ab6-0-1&quot; : &quot;c&quot;
    },
    &quot;prop&quot; : {
        &quot;r13f38818ab6-0-1&quot; : &quot;\&quot;foo\&quot;&quot;
    }
}
</code></pre></div>
<p>Now the document contains a new sub-document with the name of the new property.
The value of the property is annotated with the revision the property was set.
With each successful commit to this node, a new field is added to the
<code>_revisions</code> sub-document. Similarly the <code>_lastRev</code> sub-document and <code>_modified</code>
field are updated.</p>
<p>After the node is deleted the document looks like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;false&quot;,
        &quot;r13f38835063-2-1&quot; : &quot;true&quot;
    },
    &quot;_id&quot; : &quot;1:/node&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13f38835063-2-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1371042695),
    &quot;_modCount&quot; : NumberLong(3),
    &quot;_revisions&quot; : {
        &quot;r13f3875b5d1-0-1&quot; : &quot;c&quot;,
        &quot;r13f38818ab6-0-1&quot; : &quot;c&quot;,
        &quot;r13f38835063-2-1&quot; : &quot;c&quot;
    },
    &quot;prop&quot; : {
        &quot;r13f38818ab6-0-1&quot; : &quot;\&quot;foo\&quot;&quot;
        &quot;r13f38835063-2-1&quot; : null
    }
}
</code></pre></div>
<p>The <code>_deleted</code> sub-document now contains a <code>r13f38835063-2-1</code> field marking the
node as deleted in this revision.</p>
<p>Reading the node in previous revisions is still possible, even if it is now
marked as deleted as of revision <code>r13f38835063-2-1</code>.</p></section><section>
<h3><a name="Revisions"></a><a name="revisions"></a> Revisions</h3>
<p>As seen in the examples above, a revision is a String and may look like this:
<code>r13f38835063-2-1</code>. It consists of three parts:</p>
<ul>

<li>A timestamp derived from the system time of the machine it was generated on: <code>13f38835063</code></li>
<li>A counter to distinguish revisions created with the same timestamp: <code>-2</code></li>
<li>The cluster node id where this revision was created: <code>-1</code></li>
</ul></section><section>
<h3><a name="Commit_Root"></a><a name="commit-root"></a> Commit Root</h3>
<p>The examples so far showed how changes are committed in the most simple case
when the scope of the changes is limited to a single node / document. In this
case the commit information in the <code>_revisions</code> sub-document is stored on the
same document as the changes. When the scope of the commit spans multiple
documents, the commit information is located on the nearest common ancestor of
the changed documents. Consider a commit that creates two nodes <code>/content/en/hello</code>
and <code>/content/de/hallo</code>. The documents could look like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_id&quot; : &quot;3:/content/en/hello&quot;,
    &quot;_commitRoot&quot; : {
        &quot;r16b03ec48a2-0-1&quot; : &quot;1&quot;
    },
    &quot;_deleted&quot; : {
        &quot;r16b03ec48a2-0-1&quot; : &quot;false&quot;
    },
    &quot;_modCount&quot; : NumberLong(1),
    &quot;_modified&quot; : NumberLong(1559138945)
}

{
    &quot;_id&quot; : &quot;3:/content/de/hallo&quot;,
    &quot;_commitRoot&quot; : {
        &quot;r16b03ec48a2-0-1&quot; : &quot;1&quot;
    },
    &quot;_deleted&quot; : {
        &quot;r16b03ec48a2-0-1&quot; : &quot;false&quot;
    },
    &quot;_modCount&quot; : NumberLong(1),
    &quot;_modified&quot; : NumberLong(1559138945)
}
</code></pre></div>
<p>The commit information is now located on a different document. The reference
to the document that contains the commit information is stored as an entry in
the <code>_commitRoot</code> sub-document. In above example, the entry
<code>&quot;r16b03ec48a2-0-1&quot; : &quot;1&quot;</code> tells us which document it is. It's an ancestor of
the current document with depth one: <code>1:/content</code>. There we will find a
<code>_revisions</code> entry with the commit information:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_id&quot; : &quot;1:/content&quot;,
    &quot;_commitRoot&quot; : {
        &quot;r1672b446f0a-0-1&quot; : &quot;0&quot;
    },
    &quot;_deleted&quot; : {
        &quot;r1672b446f0a-0-1&quot; : &quot;false&quot;
    },
    &quot;_modCount&quot; : NumberLong(24),
    &quot;_modified&quot; : NumberLong(1559138945),
    &quot;_children&quot; : true,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r16b03ec48a2-0-1&quot;
    },
    &quot;_revisions&quot; : {
        &quot;r16b03ec48a2-0-1&quot; : &quot;c&quot;
    }
}
</code></pre></div></section><section>
<h3><a name="Branches"></a><a name="branches"></a> Branches</h3>
<p>The DocumentNodeStore implementation support branches, which allows to stage
multiple commits and make them visible with a single merge call. The
DocumentNodeStore implementation creates a branch automatically when there
are more than 100'000 changes pending. This is not something that can be
controlled by the application code. See also OSGi
<a href="../osgi_config.html#document-node-store">configuration</a> for the <code>DocumentNodeStoreService</code>.</p>
<p>A branch commit looks very similar to a regular commit, but instead of setting
the value of an entry in <code>_revisions</code> to <code>c</code> (committed), it marks it with
the base revision of the branch commit. In contrast to regular commits where
the commit root is the common ancestor of all nodes modified in a commit, the
commit root of a branch commit is always the root node. This is because a
branch will likely have multiple commits and a commit root must already be
known when the first commit happens on a branch. To make sure the following
branch commits can use the same commit root, the DocumentNodeStore simply picks
the root node, which always works in this case.</p>
<p>A root node may look like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91720-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(2),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda91720-0-1&quot; : &quot;c&quot;
    },
    &quot;prop&quot; : {
        &quot;r13fcda91720-0-1&quot; : &quot;\&quot;foo\&quot;&quot;
    }
}
</code></pre></div>
<p>The root node was created in revision <code>r13fcda88ac0-0-1</code> and later
in revision <code>r13fcda91720-0-1</code> property <code>prop</code> was set to <code>foo</code>.
To keep the example simple, we now assume a branch is created based
on the revision the root node was last modified and a branch commit
is done to modify the existing property. After the branch commit
the root node looks like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91720-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(3),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda91720-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;r13fcda91720-0-1&quot;
    },
    &quot;_bc&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;true&quot;
    },
    &quot;prop&quot; : {
        &quot;r13fcda91720-0-1&quot; : &quot;\&quot;foo\&quot;&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
    }
}
</code></pre></div>
<p>Note, the <code>_bc</code> sub-document was introduced with Oak 1.8 and is not present in
older versions. The branch commit revision is added to <code>_bc</code> whenever a change
is done on a document with a branch commit. This helps the DocumentNodeStore to
more easily identify branch commit changes.</p>
<p>At this point the modified property is only visible to a reader
when it reads with the branch revision <code>r13fcda919eb-0-1</code> because
the revision is marked with the base version of this commit in
the <code>_revisions</code> sub-document. Note, the <code>_lastRev</code> is not updated
for branch commits but only when a branch is merged.</p>
<p>When the branch is later merged, the root node will look like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91b12-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(4),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda91720-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;c-r13fcda91b12-0-1&quot;
    },
    &quot;_bc&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;true&quot;
    },
    &quot;prop&quot; : {
        &quot;r13fcda91720-0-1&quot; : &quot;\&quot;foo\&quot;&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
    }
}
</code></pre></div>
<p>Now, the changed property is visible to readers with a revision equal or
newer than <code>r13fcda91b12-0-1</code>.</p>
<p>The same logic is used for changes to other nodes that belong to a branch
commit. The DocumentNodeStore internally resolves the commit revision for a modification
before it decides whether a reader is able to see a given change.</p></section><section>
<h3><a name="Sweep_Revision"></a><a name="sweep-revision"></a> Sweep Revision</h3>
<p><code>@since Oak 1.8</code></p>
<p>With Oak 1.8 the concept of a sweep revision was introduced in the
DocumentNodeStore. The sweep revision of a DocumentNodeStore indicates up to
which revision non-branch changes are guaranteed to be committed. This allows
to optimize read operations because a lookup of the commit root document can
be avoided in most cases. It also means the Revision Garbage Collector can
remove previous documents that contain <code>_revisions</code> entries if they are all
older than the sweep revision.</p>
<p>The sweep revision is maintained per clusterId on the root document. Below is
the root document already presented above, amended with the sweep revision.</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91720-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(2),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda91720-0-1&quot; : &quot;c&quot;
    },
    &quot;_sweepRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91720-0-1&quot;,
    },
    &quot;prop&quot; : {
        &quot;r13fcda91720-0-1&quot; : &quot;\&quot;foo\&quot;&quot;
    }
}
</code></pre></div>
<p>As noted already, the sweep revision does not apply to branch commits. For
branch commits there is no shortcut to tell whether a change in a given revision
is committed. For those changes it is always required to look up the commit root
document and determine the merge revision. This is also the reason why the
Revision Garbage Collector cannot remove documents with this kind of commit
information.</p></section><section>
<h3><a name="Previous_Documents"></a><a name="previous-documents"></a> Previous Documents</h3>
<p>Over time the size of a document grows because the DocumentNodeStore adds data
to the document with every modification, but never deletes anything to keep the
history. Old data is moved when there are 100 commits to be moved or the
document is bigger than 1 MB. A document with a reference to old data looks like
this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcda91b12-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(1004),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda91720-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;c-r13fcda91b12-0-1&quot;
    },
    &quot;_bc&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;true&quot;
    },
    &quot;_prev&quot; : {
        &quot;r13fcda91710-0-1&quot; : &quot;r13fcda88ae0-0-1/0&quot;
    },
    &quot;prop&quot; : {
        &quot;r13fcda91720-0-1&quot; : &quot;\&quot;foo\&quot;&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
    }
}
</code></pre></div>
<p>The optional sub-document <code>_prev</code> contains a list of revision pairs, each
indicating the range of commit revisions a previous document contains. In
the above example there is one document with previous commits from
<code>r13fcda88ae0-0-1</code> to <code>r13fcda91710-0-1</code>. The id of the previous document
is derived from the upper bound of the range, the id/path of the current
document and the height in the previous document tree. More on that later.
The id of the previous document for <code>r13fcda91710-0-1</code> and <code>0:/</code> at height zero
is <code>2:p/r13fcda91710-0-1/0</code> and may looks like this:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_id&quot; : &quot;2:p/r13fcda91710-0-1/0&quot;,
    &quot;_modCount&quot; : NumberLong(1),
    &quot;_sdType&quot; : NumberLong(70),
    &quot;_sdMaxRevTime&quot; : NumberLong(1373544975),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ae0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda88af0-0-1&quot; : &quot;c&quot;,
        ...  
        &quot;r13fcda91710-0-1&quot; : &quot;c&quot;
    },
    &quot;prop&quot; : {
        &quot;r13fcda88ae0-0-1&quot; : &quot;\&quot;foo\&quot;&quot;,
        &quot;r13fcda88af0-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
        ...
        &quot;r13fcda91710-0-1&quot; : &quot;\&quot;baz\&quot;&quot;
    }
}
</code></pre></div>
<p>Previous documents only contain immutable data, which means it only contains
committed and merged <code>_revisions</code>. This also means the previous ranges of
committed data may overlap because branch commits are not moved to previous
documents until the branch is merged.</p>
<p>Previous documents contain metadata not present on the main document. Each
previous document has a <code>_sdType</code>, which plays a role for the Revision Garbage
Collector whether a previous document can be collected later. The <code>_sdType</code>
values are defined in the enum <a class="externalLink" href="https://github.com/apache/jackrabbit-oak/blob/jackrabbit-oak-1.12.0/oak-store-document/src/main/java/org/apache/jackrabbit/oak/plugins/document/NodeDocument.java#L268">SplitDocType</a>.
The term &#x201c;split document&#x201d; is used as a synonym for &#x201c;previous document&#x201d;. The
most commonly used types are (<code>_sdType</code> in parentheses):</p>
<ul>

<li>DEFAULT(10): contains all kinds of changes and commit information.</li>
<li>INTERMEDIATE(40): an intermediate document that creates a tree of split documents.</li>
<li>DEFAULT_LEAF(50): contains changes from nodes that were leafs in the node tree.</li>
<li>COMMIT_ROOT_ONLY(60): contains only changes where the commit root was not on the document itself.</li>
<li>DEFAULT_NO_BRANCH(70): contains all kind of changes and commit information, except from branches.</li>
</ul>
<p>The Revision Garbage Collection will only collect <code>_sdType</code> with values 40, 50,
60 and 70 when the previous documents are older than 24 hours (this is
configurable). Previous documents of <code>_sdType</code> 10 are currently kept forever.</p>
<p>Over time the main document will accumulate reference to previous documents. To
prevent unlimited growth of the main document, the DocumentNodeStore will also
move <code>_prev</code> entries to a new previous document of type INTERMEDIATE(40). This
happens whenever there are 10 <code>_prev</code> entries for a clusterId with the same
height. The first intermediate previous document is therefore created when
ten previous documents with height 0 exist.</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcdb0190a-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(2404),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;c-r13fcda91b12-0-1&quot;
    },
    &quot;_bc&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;true&quot;
    },
    &quot;_prev&quot; : {
        &quot;r13fcda91710-0-1&quot; : &quot;r13fcda88ae0-0-1/0&quot;,
        &quot;r13fcda9293a-0-1&quot; : &quot;r13fcda91720-0-1/0&quot;,
        &quot;r13fcdab07a4-0-1&quot; : &quot;r13fcdaa03ab-0-1/0&quot;,
        &quot;r13fcdac4984-0-1&quot; : &quot;r13fcdac0389-0-1/0&quot;,
        &quot;r13fcdac7a91-0-1&quot; : &quot;r13fcdac509a-0-1/0&quot;,
        &quot;r13fcdad0a12-0-1&quot; : &quot;r13fcdac7c41-0-1/0&quot;,
        &quot;r13fcdad940a-0-1&quot; : &quot;r13fcdad302d-0-1/0&quot;,
        &quot;r13fcdae0a94-0-1&quot; : &quot;r13fcdade914-0-1/0&quot;,
        &quot;r13fcdaef0a0-0-1&quot; : &quot;r13fcdae4d03-0-1/0&quot;,
        &quot;r13fcdb0190a-0-1&quot; : &quot;r13fcdaf10f3-0-1/0&quot;,
    },
    &quot;prop&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
    }
}
</code></pre></div>
<p>Above would be turned into:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_deleted&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;false&quot;,
    },
    &quot;_id&quot; : &quot;0:/&quot;,
    &quot;_lastRev&quot; : {
        &quot;r0-0-1&quot; : &quot;r13fcdb0190a-0-1&quot;
    },
    &quot;_modified&quot; : NumberLong(1373544975),
    &quot;_modCount&quot; : NumberLong(2405),
    &quot;_revisions&quot; : {
        &quot;r13fcda88ac0-0-1&quot; : &quot;c&quot;,
        &quot;r13fcda919eb-0-1&quot; : &quot;c-r13fcda91b12-0-1&quot;
    },
    &quot;_bc&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;true&quot;
    },
    &quot;_prev&quot; : {
        &quot;r13fcdb0190a-0-1&quot; : &quot;r13fcda88ae0-0-1/1&quot;,
    },
    &quot;prop&quot; : {
        &quot;r13fcda919eb-0-1&quot; : &quot;\&quot;bar\&quot;&quot;,
    }
}
</code></pre></div>
<p>And a new intermediate split document:</p>

<div class="source"><pre class="prettyprint"><code>{
    &quot;_id&quot; : &quot;2:p/r13fcdb0190a-0-1/1&quot;,
    &quot;_prev&quot; : {
        &quot;r13fcda91710-0-1&quot; : &quot;r13fcda88ae0-0-1/0&quot;,
        &quot;r13fcda9293a-0-1&quot; : &quot;r13fcda91720-0-1/0&quot;,
        &quot;r13fcdab07a4-0-1&quot; : &quot;r13fcdaa03ab-0-1/0&quot;,
        &quot;r13fcdac4984-0-1&quot; : &quot;r13fcdac0389-0-1/0&quot;,
        &quot;r13fcdac7a91-0-1&quot; : &quot;r13fcdac509a-0-1/0&quot;,
        &quot;r13fcdad0a12-0-1&quot; : &quot;r13fcdac7c41-0-1/0&quot;,
        &quot;r13fcdad940a-0-1&quot; : &quot;r13fcdad302d-0-1/0&quot;,
        &quot;r13fcdae0a94-0-1&quot; : &quot;r13fcdade914-0-1/0&quot;,
        &quot;r13fcdaef0a0-0-1&quot; : &quot;r13fcdae4d03-0-1/0&quot;,
        &quot;r13fcdb0190a-0-1&quot; : &quot;r13fcdaf10f3-0-1/0&quot;,
    },
    &quot;_sdType&quot; : NumberLong(40),
    &quot;_sdMaxRevTime&quot; : NumberLong(1373545435),
    &quot;_modCount&quot; : NumberLong(1)
}
</code></pre></div></section></section><section>
<h2><a name="Clock_requirements"></a><a name="clock-requirements"></a> Clock requirements</h2>
<p>Revisions are used by the DocumentNodeStore to identify the sequence of changes done
on items in the repository. This is also done across cluster nodes for revisions
with different cluster node ids. This requires the system clocks on the machines
running Oak and the backend system to approximately in sync. It is recommended
to run an NTP daemon or some similar service to keep the clock synchronized.
Oak allows clock differences up to 2 seconds between the machine where Oak is
running and the machine where the backend store (MongoDB or RDBMS) is running.
Oak may refuse to start if it detects a larger clock difference. Clock
differences between the machines running in an Oak cluster will result in
delayed propagation of changes between cluster nodes and warnings in the log
files.</p></section><section>
<h2><a name="Node_Bundling"></a><a name="node-bundling"></a> Node Bundling</h2>
<p><code>@since Oak 1.6</code></p>
<p>Refer to <a href="document/node-bundling.html">Node Bundling</a></p></section><section>
<h2><a name="Background_Operations"></a><a name="background-operations"></a> Background Operations</h2>
<p>Each DocumentNodeStore instance connecting to same database in Mongo server
performs certain background task.</p><section>
<h3><a name="Renew_Cluster_Id_Lease"></a><a name="renew-cluster-id-lease"></a> Renew Cluster Id Lease</h3>
<p>Each cluster node uses a unique cluster node id, which is the last part of the revision id.
Each cluster node has a lease on the cluster node id, as described in the section
<a href="#Cluster_Node_Metadata">Cluster Node Metadata</a>.</p></section><section>
<h3><a name="Background_Document_Split"></a><a name="background-document-split"></a> Background Document Split</h3>
<p>The DocumentNodeStore periodically checks documents for their size and if
necessary splits them up and moves old data to a previous document. This is done
in the background by each DocumentNodeStore instance for the data it created.</p></section><section>
<h3><a name="Background_Writes"></a><a name="background-writes"></a> Background Writes</h3>
<p>While performing commits there are certain nodes which are modified but do not become part
of commit. For example when a node under /a/b/c is updated then the <code>_lastRev</code> property
of all ancestors also need to be updated to the commit revision. Such changes are accumulated
and flushed periodically through a asynchronous job.</p></section><section>
<h3><a name="Background_Reads"></a><a name="bg-read"></a> Background Reads</h3>
<p>The DocumentNodeStore periodically picks up changes from other DocumentNodeStore
instances by polling the root node for changes of <code>_lastRev</code>. This happens once
every second.</p></section></section><section>
<h2><a name="Metrics_and_Monitoring"></a><a name="metrics"></a> Metrics and Monitoring</h2>
<p>See <a href="document/metrics.html">DocumentNodeStore and DocumentStore metrics</a>.</p></section><section>
<h2><a name="Cluster_Node_Metadata"></a><a name="cluster-node-metadata"></a> Cluster Node Metadata</h2>
<p>Cluster node metadata is stored in the <code>clusterNodes</code> collection. There is one
entry for each cluster node that is running, and there may be entries for
cluster nodes that were running in the past. Old entries are kept so that if a
cluster node is started again, it gets the same cluster node ID as before (which
is not strictly needed for consistency, but nice for support, if one would want
to find out which change originated from which cluster node). Starting with Oak
1.10, acquiring a cluster node ID changed slightly. A cluster node may now also
acquire an inactive cluster node ID created by another cluster node.</p>
<p>The entries of a <code>clusterNodes</code> collection may look like this:</p>

<div class="source"><pre class="prettyprint"><code>&gt; db.clusterNodes.find().pretty()

{
	&quot;_id&quot; : &quot;1&quot;,
	&quot;_modCount&quot; : NumberLong(490),
	&quot;state&quot; : &quot;ACTIVE&quot;,
	&quot;leaseEnd&quot; : NumberLong(&quot;1390465250135&quot;),
	&quot;instance&quot; : &quot;/home/oak&quot;,
	&quot;machine&quot; : &quot;mac:20c9d043f141&quot;,
	&quot;info&quot; : &quot;...pid: 983, uuid: 6b6e8e4f-8322-4b19-a2b2-de0c573620b9 ...&quot;
}
{
	&quot;_id&quot; : &quot;2&quot;,
	&quot;_modCount&quot; : NumberLong(492),
	&quot;state&quot; : &quot;ACTIVE&quot;,
	&quot;leaseEnd&quot; : NumberLong(&quot;1390465255192&quot;),
	&quot;instance&quot; : &quot;/home/oak&quot;,
	&quot;machine&quot; : &quot;mac:30c3d053f247&quot;,
	&quot;info&quot; : &quot;...pid: 843, uuid: 28ada13d-ec9c-4d48-aeb9-cef53aa4bb9e ...&quot;
}
</code></pre></div>
<p>In the above example, there are two active cluster nodes running with IDs <code>1</code>
and <code>2</code>. The <code>_id</code> corresponds to the last part of the revisions generated by a
cluster node. Please note, the <code>_id</code> representation is base 10, while the
ID part of a revision is base 16! The <code>instance</code> is the current working
directory and the <code>machine</code> is the lowest number of an active network adapter's
MAC address. If no active network adapter is available, then the value for the
<code>machine</code> field will be a random UUID. The <code>info</code> field contains the same info
as a string, plus additional information like the process ID.</p>
<p>The diagram shows the different states a cluster node entry can be in.</p>
<p><img src="document/cluster-node-lease.png" alt="Cluster node ID state diagram" /></p><section>
<h3><a name="Acquire_a_cluster_node_ID"></a><a name="acquire-a-cluster-node-id"></a> Acquire a cluster node ID</h3>
<p>There are different ways how a cluster node acquires an ID.</p>
<p>In the most simple case there are no existing entries in the <code>clusterNodes</code>
collection and the cluster node will create a new active entry with <code>_id=&quot;1&quot;</code>.
The <code>leaseEnd</code> will already be set to a value higher than the current time. This
entry is now considered active and in use. Similarly, when a second cluster node
starts up, then it will create a new active entry with <code>_id=&quot;2&quot;</code> and so on for
more cluster nodes.</p>
<p>When a cluster node is shut down, the cluster node ID is released and put into
the inactive state. This is reflected in the entry with a <code>state</code> and <code>leaseEnd</code>
field set to <code>null</code>. On startup, the cluster node will re-acquire the same entry
because the <code>machine</code> and <code>instance</code> field match its environment.</p>
<p>Immediately restarting a crashed cluster node will lead to a somewhat delayed
startup, because the cluster node will find a matching and active cluster node
ID. In this case, the cluster node will wait until the lease expires (up to two
minutes if the process crashed right after the lease was extended) and then run
the recovery process for the cluster node ID. Depending on timing, the recovery
may also be started by another active cluster node. In this case, the starting
cluster node would wait up to one minute for the recovery to finish. Either way,
if the recovery was successful, the cluster node ID will have transitioned to
the inactive state and can be acquired again as described before.</p>
<p>When a new cluster node is started and there is an inactive entry, then the
cluster node will try to acquire it, even when its environment does not match
the <code>machine</code> and <code>instance</code> fields. This behaviour is new and was introduced
with Oak 1.10. Previous versions ignore entries that do not match the
environment and would create a new entry.</p></section><section>
<h3><a name="Update_lease_for_a_cluster_node_ID"></a><a name="update-lease-for-a-cluster-node-id"></a> Update lease for a cluster node ID</h3>
<p>Each running cluster node updates the <code>leaseEnd</code> time of the cluster node ID
every ten seconds, to ensure each cluster node uses a different cluster node ID.
The time is the number of milliseconds since 1970 and with every update the
<code>leaseEnd</code> is set two minutes ahead of the current time. This lease mechanism
allows other cluster nodes to identify active, inactive and crashed cluster nodes.</p>
<p>Starting with Oak 1.4 the DocumentNodeStore will invoke a lease failure handler
when it was unable to renew the lease in time. When deployed in an OSGi
container, the <code>DocumentNodeStoreService</code> implements a lease failure handler
that will stop the bundle with the DocumentNodeStore implementation. At this
point appropriate monitoring of the system should detect this situation and
restart the process. In addition to calling the lease failure handler, the
DocumentNodeStore will also reject all future access to the underlying
<code>DocumentStore</code> with a <code>DocumentStoreException</code>.</p>
<p>The initial lease update mechanism implemented with Oak 1.4 is somewhat lenient.
The implementation allows a lease update when it actually knows the lease
expired. The reason for this decision was developer friendliness. Debugging a
system often means the JVM is suspended for a while, which may result in an
expired lease. In this situation, the DocumentNodeStore gives the background
lease update thread a chance to still update the lease.</p>
<p>With Oak 1.10 a new lease update mode was introduced: <code>STRICT</code>. This is the
new default and immediately rejects access to the DocumentStore and calls the
failure handler, when it detects an expired lease. The previous behaviour is
still available with the <code>LENIENT</code> mode.
See also OSGi <a href="../osgi_config.html#document-node-store">configuration</a> for the
<code>DocumentNodeStoreService</code>.</p>
<p>For testing purposes is it also possible to disable the lease check entirely
with a system property: <code>-Doak.documentMK.disableLeaseCheck=true</code>.</p></section><section>
<h3><a name="Recovery_for_a_cluster_node_ID"></a><a name="recovery-for-a-cluster-node-id"></a> Recovery for a cluster node ID</h3>
<p>Recovery becomes necessary when the lease on a cluster node ID entry expires.
This usually happens when the process that acquired the cluster node ID crashes,
but the lease may also expire if the cluster node fails to extend the lease in
time. In the latter case, the cluster node is obligated to stop any further
operations on the document store. The current implementation does this by
blocking operations on the document store level and stopping the
oak-store-document bundle when it detects an outdated lease. Other active
cluster nodes or the restarted cluster node are then responsible for running
recovery for the relevant cluster node ID and setting the state back to
inactive.</p>
<p>Before a cluster node can run the recovery process, the recovery lock on the
cluster node ID entry must be acquired. This lock again is protected with a
lease to detect a crashed cluster node that was performing recovery and left
behind a recovery lock. Other cluster nodes will therefore check whether the
cluster node ID identified by <code>recoveryBy</code> is still active and try to break
the recovery lock if the recovering cluster node is considered inactive or
expired.</p>
<p>There is a special case when a starting cluster node performs the recovery for
itself. That is, for the cluster node ID it wants to acquire but first has to
run recovery for it. In this case the lease is only updated once for the cluster
node entry ID entry that needs recovery. This happens when the recovery lock is
set on the entry. The starting cluster node then must finish the recovery within
this initial lease deadline, otherwise the recovery will be considered failed
and the starting cluster node will acquire a different (potentially new) ID. The
failed recovery will then be performed later by a background job of one of the
active cluster nodes.</p></section><section>
<h3><a name="Specifying_the_Read_Preference_and_Write_Concern"></a><a name="rw-preference"></a> Specifying the Read Preference and Write Concern</h3>
<p>See <a href="document/mongo-document-store.html#configuration">configuration</a> of a <code>MongoDocumentStore</code>.</p></section></section><section>
<h2><a name="Caching"></a><a name="cache"></a> Caching</h2>
<p><code>DocumentNodeStore</code> maintains multiple caches to provide an optimum performance.
By default the cached instances are kept in heap memory but some of the caches
can be backed by <a href="persistent-cache.html">persistent cache</a>.</p>
<ol style="list-style-type: decimal">

<li>

<p><code>documentCache</code> - Document cache is used for caching the <code>NodeDocument</code>
instance. These are in memory representation of the persistent state. For
example in case of Mongo it maps to the Mongo document in <code>nodes</code> collection
and for RDB its maps to the row in <code>NODES</code> table. There is a class of <code>NodeDocument</code>
(leaf level split documents) which, since <code>1.3.15</code> are cached under
<code>prevDocCache</code> (see below)</p>
<p>Depending on the <code>DocumentStore</code> implementation different heuristics are
applied for invalidating the cache entries based on changes in backend</p>
</li>
<li>

<p><code>prevDocCache</code> - Previous document cache is used for caching the <code>NodeDocument</code>
instance representing leaf level split documents. Unlike other type of
<code>NodeDocument</code>, these are immutable and hence don't require invalidation.
If configured, this cache can exploit persistent cache as well.
Similar to other <code>NodeDocument</code> these are also in memory representation of
the persistent state. (since <code>1.3.15</code>)</p>
<p>Depending on the <code>DocumentStore</code> implementation different heuristics are
applied for invalidating the cache entries based on changes in backend</p>
</li>
<li>

<p><code>docChildrenCache</code> - Document Children cache is used to cache the children
state for a given parent node. This is invalidated completely upon every
background read. This cache was removed in 1.5.6.</p>
</li>
<li>

<p><code>nodeCache</code> - Node cache is used to cache the <code>DocumentNodeState</code> instances.
These are <b>immutable</b> view of <code>NodeDocument</code> as seen at a given revision
hence no consistency checks are to be performed for them</p>
</li>
<li>

<p><code>childrenCache</code> - Children cache is used to cache the children for a given
node. These are also <b>immutable</b> and represent the state of children for
a given parent at certain revision</p>
</li>
<li>

<p><code>diffCache</code> - Caches the diff for the changes done between successive revision.
For local changes done the diff is add to the cache upon commit while for
external changes the diff entries are added upon computation of diff as part
of observation call</p>
</li>
</ol>
<p>All the above caches are managed on heap. For the last 3 <code>nodeCache</code>,
<code>childrenCache</code> and <code>diffCache</code> Oak provides support for [persistent cache]
(persistent-cache.html). By enabling the persistent cache feature Oak can manage
a much larger cache off heap and thus avoid freeing up heap memory for application
usage.</p><section>
<h3><a name="Cache_Invalidation"></a><a name="cache-invalidation"></a> Cache Invalidation</h3>
<p><code>documentCache</code> and <code>docChildrenCache</code> are containing mutable state which requires
consistency checks to be performed to keep them in sync with the backend persisted
state. Oak uses a MVCC model under which it maintains a consistent view of a given
Node at a given revision. This allows using local cache instead of using a global
clustered cache where changes made by any other cluster node need not be instantly
reflected on all other nodes.</p>
<p>Each cluster node periodically performs <a href="#bg-read">background reads</a> to pickup
changes done by other cluster nodes. At that time it performs [consistency check]
<a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-1156">OAK-1156</a> to ensure that cached instance state reflect the state in the backend
persisted state. Performing the check would take some time would be proportional
number of entries present in the cache.</p>
<p>For repository to work properly its important to ensure that such background reads
do not consume much time and <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-2646">work is underway</a> to improve current
approach. <i>To ensure that such background operation (which include the cache
invalidation checks) perform quickly one should not set a large size for
these caches</i>.</p>
<p>All other caches consist of immutable state and hence no cache invalidation needs
to be performed for them. For that reason those caches can be backed by persistent
cache and even having large number of entries in such caches would not be a matter
of concern.</p></section><section>
<h3><a name="Cache_Configuration"></a><a name="cache-configuration"></a> Cache Configuration</h3>
<p>In a default setup the <a href="../osgi_config.html#document-node-store">DocumentNodeStoreService</a>
takes a single config for <code>cache</code> which is internally distributed among the
various caches above in following way</p>
<ol style="list-style-type: decimal">

<li><code>nodeCache</code> - 35% (was 25% until 1.5.14)</li>
<li><code>prevDocCache</code> - 4%</li>
<li><code>childrenCache</code> - 15% (was 10% until 1.5.14)</li>
<li><code>diffCache</code> - 30% (was 4% until 1.5.14)</li>
<li><code>documentCache</code> - Is given the rest i.e. 16%</li>
<li><code>docChildrenCache</code> - 0% (removed in 1.5.6, default was 3%)</li>
</ol>
<p>Lately <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-2546">options are provided</a> to have a fine grained control over the
distribution. See <a href="../osgi_config.html#cache-allocation">Cache Allocation</a></p>
<p>While distributing ensure that cache left for <code>documentCache</code> is not very large
i.e. prefer to keep that ~500 MB max or lower. As a large <code>documentCache</code> can
lead to increase in the time taken to perform cache invalidation.</p>
<p>Further make use of the persistent cache. This reduces pressure on GC by keeping
instances off heap with slight decrease in performance compared to keeping them
on heap.</p></section></section><section>
<h2><a name="Unlock_upgrade"></a><a name="unlockUpgrade"></a> Unlock upgrade</h2>
<p>On startup the DocumentNodeStore checks if its version is compatible with the
format version currently in use. A read-only DocumentNodeStore can read the
current version as well as older versions. A read-write DocumentNodeStore on the
other hand can only write to the DocumentStore when the format version matches
its own version. The DocumentNodeStore maintains this format version in the
<code>settings</code> collection accessible to all cluster nodes.</p>
<p>Upgrading to a newer Oak version may therefore first require an update of the
format version before a newer version of a DocumentNodeStore can be started on
existing data. The oak-run tools contains an <code>unlockUpgrade</code> mode to perform
this operation. Use the oak-run tool with the version matching the target
upgrade version to unlock an upgrade with the following command. The below
example unlocks an upgrade to 1.8 with a DocumentNodeStore on MongoDB:</p>

<div class="source"><pre class="prettyprint"><code>&gt; java -jar oak-run-1.8.0.jar unlockUpgrade mongodb://example.com:27017/oak
</code></pre></div>
<p>Please note that unlocking an upgrade is only possible when all cluster nodes
are inactive, otherwise the command will refuse to change the format version.</p>
<p>See also detailed instructions for various <a href="document/upgrade.html">upgrade</a>
paths.</p></section><section>
<h2><a name="Secondary_Store"></a><a name="secondary-store"></a> Secondary Store</h2>
<p><code>@since Oak 1.6</code></p>
<p>Refer to <a href="document/secondary-store.html">Secondary Store</a></p></section><section>
<h2><a name="Revision_Garbage_Collection"></a><a name="revision-gc"></a> Revision Garbage Collection</h2>
<p>As described in the section <a href="#node-content-model">Node Content Model</a>, the
DocumentNodeStore does not overwrite existing data but adds it to an existing
document when a property is updated. Cleaning up old data, which is not needed
anymore is done with a process called <code>Revision Garbage Collection</code>. Depending
on deployment this process does not run automatically and must be triggered
periodically by the application. The garbage collection process adds some
pressure on the system, so the application should trigger it when it is most
convenient. E.g. at night, when systems are usually not that busy. It is usually
sufficient to run it once a day. There are several ways how the revision garbage
collection can be triggered:</p>
<ul>

<li>Call <code>startRevisionGC()</code> on the <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/api/jmx/RepositoryManagementMBean.html">RepositoryManagementMBean</a></li>
<li>Call <a class="externalLink" href="http://jackrabbit.apache.org/oak/docs/apidocs/org/apache/jackrabbit/oak/plugins/document/VersionGarbageCollector.html#gc-long-java.util.concurrent.TimeUnit-">gc()</a> on the <code>VersionGarbageCollector</code> obtained from the <code>DocumentNodeStore</code> instance</li>
<li>Use the oak-run runnable jar file with the <code>revisions</code> run mode (<code>@since Oak 1.8</code>).</li>
</ul>
<p>The first two options are not described in more detail, because both of them
are simple method calls. The third option comes with some sub commands as
described below when oak-run with the <code>revisions</code> run mode is invoked without
parameters or options:</p>

<div class="source"><pre class="prettyprint"><code>revisions mongodb://host:port/database &lt;sub-command&gt; [options]
</code></pre></div>
<p>(or, for RDBMK instances, use &#x201c;jdbc:&#x2026;&#x201d;).</p>

<div class="source"><pre class="prettyprint"><code>where sub-command is one of

  info     give information about the revisions state without performing
           any modifications
  collect  perform garbage collection
  reset    clear all persisted metadata
  sweep    clean up uncommitted changes

Option                 Description
------                 -----------
-?, -h, --help         show help
--cacheSize &lt;Integer&gt;  cache size (default: 0)
--clusterId &lt;Integer&gt;  DocumentMK clusterId (default: 0)
--continuous           run continuously (collect only)
--delay &lt;Double&gt;       introduce delays to reduce impact on
                         system (default: 0.0)
--disableBranches      disable branches
--limit &lt;Integer&gt;      collect at most limit documents
                         (default: -1)
--olderThan &lt;Long&gt;     collect only docs older than n seconds
                         (default: 86400)
--once                 only 1 iteration
--rdbjdbcpasswd        RDB JDBC password (default: )
--rdbjdbcuser          RDB JDBC user (default: )
--timeLimit &lt;Long&gt;     cancel garbage collection after n
                         seconds (default: -1)
--verbose              print INFO messages to the console
</code></pre></div>
<p>A revision garbage collection can be invoked while the system is online and
running. Using the oak-run runnable jar, a revision GC on a system using the
MongoDB backend can be initiated with:</p>

<div class="source"><pre class="prettyprint"><code>java -jar oak-run-1.8.0.jar revisions mongodb://localhost:27017/oak collect
</code></pre></div>
<p>This will collect changes identified as garbage, which is older than 24 hours.</p>
<p>Starting with Oak 1.8 the DocumentNodeStoreService can trigger Revision Garbage
Collection (RGC) automatically. The default schedule depends on the type of
backend. On RDB the service will not schedule a RGC, which is the same behavior
as in previous Oak versions. Whereas on MongoDB the RGC runs every five seconds.
The latter is also known as <code>Continuous Revision Garbage Collection</code>. In this
mode, the RGC will not log every run but only write an INFO message every hour
summarizing the GC cycles for the past hour.
For more details, see also the <a href="../osgi_config.html#document-node-store">OSGi configuration</a> page.</p></section><section>
<h2><a name="Pending_Topics"></a><a name="pending-topics"></a> Pending Topics</h2><section>
<h3><a name="Conflict_Detection_and_Handling"></a><a name="conflict-detection-and-handling"></a> Conflict Detection and Handling</h3></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>&#169; 2012-2024
<a href="https://www.apache.org/">The Apache Software Foundation</a> &vert; <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>